{smcl}
{txt}{sf}{ul off}{.-}
       log:  {res}C:\Users\n06017\Documents\Magic Briefcase\pc8_over_time\output\pc8_over_time_1993_2010.smcl
  {txt}log type:  {res}smcl
 {txt}opened on:  {res} 1 Aug 2012, 07:02:18
{txt}
{com}. 
. 
. ****************************************************    
. *** Step 0: preparation of files: optional codes ***
. ****************************************************
. * file with all optional codes between 1993 and 2005: optional_codes_1993_2005
. * file with all N-list codes between 1993-2005: Nlist_codes_1993_2005
. * Starting 2005, all optional (B-list) and N-list codes have been abolished.
. 
.                 
. * 0/ Generate a file with all optional codes that feature during the chosen sample period (between `b' and `e')
.         * and their corresponding mandatory codes
.         * this file needs to be merged with prodcom data (before concording the data) 
.                 * and with CN8-PC8 concordance in final year of the data period
.                 * merge with CN8-PC8 concordance is only necessary when concording production and trade data
.                 * and will only affect PC8 codes that were optional at some point during sample period and mandatory later on
.                 * for these codes, we need to keep the more aggregated PC code throughout
.                 * if concordance period starts after 2004, not necessary to run this step (if condition at start ensures this)
.         
.         if `b' < 2005 {c -(}
.                 
.                 if `e' < 2005 {c -(}
.                         local f = `e' 
.                         {c )-}
.                 
.                 if `e' >= 2005 {c -(}
.                         local f = 2004 
.                         {c )-}
.                 
.                 use PC_`b'_Blist, clear
.                         forval x = `b1' / `f' {c -(}
{txt}  2{com}.                                 append using PC_`x'_Blist
{txt}  3{com}.                                 {c )-}
.                 
.                 duplicates drop

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(8321 observations deleted)
{com}.                 tostring pc, replace
{txt}pc was {res:long} now {res:str8}
{com}.                 rename pc pc8
.                 sort pc8
.                 merge pc8 using optional_codes_1993_2005
.                 tab _m

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          3 {c |}{res}      1,116      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      1,116      100.00
{com}.                 drop if _m==2
{txt}(0 observations deleted)
{com}.                         * _m==1 should not occur
.                 drop _m
.                 sort pc8
.         save optional_codes_`b'_`e'_sample, replace
{txt}file optional_codes_1993_2010_sample.dta saved
{com}.         {c )-}
{txt}
{com}.                         
. 
. * 1/ create concordance of PC8 over time with mandatory codes only
.         * need to recode all codes that have been optional at some point in time
.         * in some cases, optional code later becomes mandatory
.         * in these cases, we keep the more aggregated code during the whole sample period
.         * Remark: when merging with CN8 using CN8-PC8 concordance file, 
.                 * these optional codes that become mandatory at some point will also have to be recoded in the CN8-PC8 concordance file!
.         
.                 insheet using input_file_PC_over_time_edited.csv, clear delimit(";")
{txt}(15 vars, 8005 obs)

{com}.                         * this file is an edited version of Eurostat's original files with changes over time
.                         * For instance, when concording data between 1998 and 2006, many optional codes would drop out in 2005
.                                 * i.e. the optional code would be listed as "obsolete" and no "new" code would be given
.                                 * if we would simply replace the optional code by its mandatory code in all of these cases
.                                 * we would drop these mandatory codes from the data because they are not covered in all years
.                                 * However, in the majority of cases, the mandatory code does not drop out, only the optional breakdown disappears
.                                 * In these cases, we have manually entered the mandatory code as the "new" code in the input file
.                                 * IF the mandatory code continues to exist in the next year (verified in Prodcom structure files)
.                         * Similar corrections have been applied for aggregate codes (Z, T, Q) and for the N-list codes
.                         * Original Eurostat file can be found in the folder "Originals Ramon"
.                          
.                         drop pcfrom_recode pcto_recode
{txt}
{com}.                 
.         if `b' < 2005 {c -(}
.                 
.                 * merge obsolete codes with file with optional codes to recode them
.                         rename pcfrom pc8
.                         sort pc8
.                         count
{res} 8005
{com}.                         merge pc8 using optional_codes_`b'_`e'_sample
{txt}{p 0 4}
variable{txt} pc8
does not uniquely identify observations in
the master data
{p_end}
{com}.                         tab _m

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      6,857       85.43       85.43
{txt}          2 {c |}{res}         21        0.26       85.70
{txt}          3 {c |}{res}      1,148       14.30      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      8,026      100.00
{com}.                         replace pc8 = pc_mand if _m==3
{txt}(1148 real changes made)
{com}.                         drop if _m==2
{txt}(21 observations deleted)
{com}.                         count
{res} 8005
{com}.                         rename pc8 pcfrom
.                 
.                 * merge new codes with file with optional codes to recode them
.                         rename pcto pc8
.                         sort pc8
.                         count
{res} 8005
{com}.                         drop _m
.                         merge pc8 using optional_codes_`b'_`e'_sample
{txt}{p 0 4}
variable{txt} pc8
does not uniquely identify observations in
the master data
{p_end}
{com}.                         tab _m

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      7,798       87.38       87.38
{txt}          2 {c |}{res}        919       10.30       97.68
{txt}          3 {c |}{res}        207        2.32      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      8,924      100.00
{com}.                         replace pc8 = pc_mand if _m==3
{txt}(207 real changes made)
{com}.                         drop if _m==2
{txt}(919 observations deleted)
{com}.                         rename pc8 pcto
.                         
.                 {c )-}
{txt}
{com}.                         
.                 * drop duplicate lines (resulting from changes in optional codes that imply no changes in mandatory codes)
.                         drop opt n v10 v12 source v14 _m pc_mand
{txt}
{com}.                         
.                         rename to effyr
{txt}
{com}.                         drop from
{txt}
{com}.                         rename pcfrom obsolete
{txt}
{com}.                         rename pcto new
{txt}
{com}. 
.                         replace obsolete="" if obsolete=="-----"
{txt}(1 real change made)

{com}.                         replace new="" if new=="-----"
{txt}(1 real change made)

{com}.                         replace obsolete="" if obsolete=="--"
{txt}(1 real change made)

{com}.                         
.                         duplicates drop

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(748 observations deleted)

{com}.                         drop if obsolete==new & ex=="" & v9==""
{txt}(398 observations deleted)

{com}.                                 * ex variables indicate partial mapping
.                         drop v15 ex v9
{txt}
{com}.                 save temp, replace
{txt}(note: file temp.dta not found)
file temp.dta saved

{com}. 
. * 2/ drop all Q, T, Z and N codes from concordance over time file
.                         * N and B codes are recoded (see 1/ for B-codes)
.                         * Q, T, and Z codes are more aggregated versions of existing PC codes
.                         * these codes should not feature in the prodcom data, since countries are required to report PC data at the most detailed level
.                         * In the concordance files between CN8 and PC8, the PC8 codes feature in their more aggregate versions
.                                 * T and Q codes feature both in aggregated and disaggregated  form, but Z-codes only feature in their more aggregate form 
.                                 * hence, when concording CN8-PC8 (either to PC8 or HS6), disaggregated counterparts of Z-codes need to be recoded 
.                                 * both in the prodcom list files for each year and in the data (cfr. section 3.4 in the paper)
.                         * All of these "special" codes (optional (N- or B-list), T, Q, Z) can be found in the prodcom structure files
.                                 * PDF, access or excel files for each year
.         
.         * N-codes: do not feature in concordance file
.         * Q, T and Z-codes: 
.                 use TZQlist_codes_1993_2010.dta, replace
{txt}
{com}.                         * compiled from prodcom structure files in different years
.                         drop year
{txt}
{com}.                         sort pc
{txt}
{com}.                         duplicates drop

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(1988 observations deleted)

{com}.                         sort pc
{txt}
{com}.                 save tqz_temp, replace
{txt}(note: file tqz_temp.dta not found)
file tqz_temp.dta saved

{com}.         
.                 use temp, clear
{txt}
{com}.                         rename obsolete pc
{txt}
{com}.                         sort pc
{txt}
{com}.                         merge pc using tqz_temp
{txt}{p 0 4}
variable{txt} pc
does not uniquely identify observations in
the master data
{p_end}
pc was {res}str8{txt} now {res}str9
{txt}
{com}.                         tab _m

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      6,640       95.88       95.88
{txt}          2 {c |}{res}         66        0.95       96.84
{txt}          3 {c |}{res}        219        3.16      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      6,925      100.00
{txt}
{com}.                         drop if _m==3 | _m==2
{txt}(285 observations deleted)

{com}.                                 * can be dropped, if recoding was required this is done in the input file
.                         rename pc obsolete
{txt}
{com}.                         drop _m
{txt}
{com}.                         
.                         rename new pc
{txt}
{com}.                         sort pc
{txt}
{com}.                         merge pc using tqz_temp
{txt}{p 0 4}
variable{txt} pc
does not uniquely identify observations in
the master data
{p_end}
pc was {res}str8{txt} now {res}str9
{txt}
{com}.                         tab _m

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      6,581       95.89       95.89
{txt}          2 {c |}{res}        223        3.25       99.14
{txt}          3 {c |}{res}         59        0.86      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      6,863      100.00
{txt}
{com}.                         drop if _m==3 | _m==2
{txt}(282 observations deleted)

{com}.                                 * idem, can be dropped, if recoding was required this is done in the input file
.                         rename pc new
{txt}
{com}.                         drop _m
{txt}
{com}.                 save input_file_PC_over_time_edited, replace
{txt}(note: file input_file_PC_over_time_edited.dta not found)
file input_file_PC_over_time_edited.dta saved

{com}.                 erase tqz_temp.dta
{txt}
{com}.                 
. ******************************************************* 
. *** Step 1: preparation of files: identify mappings ***
. *******************************************************
. 
. * Need to identify different type of mappings between PC8 in t and t+1 (effyr)
. * i.e. growing or shrinking families respectively.
. 
. * base file: conversion_pc_overtime_input.xls
.         * three Eurostat base files: "PRODCOM_YEARLY_UPDATE_OF_CODES_SINCE_1994.xls" (until 2009), "prodcom 1994 - prodcom 1993.pdf" (translated into excel) and "PRC 2010- PRC 2009.xls" 
.         * concordance only contains "regular codes", no B-list, N-list, Q-, Z- or T-list codes.
.         * B-list and N-list codes might feature in the data, need to be recoded into mandatory codes where necessary
.         
.         use input_file_PC_over_time_edited, clear 
{txt}
{com}.                         sort new
{txt}
{com}.                 
.                         
. * rename vars + procedure to break up codes (spaces need to removed) and put them back together as strings
.         /* Effyr is the "To" year in the original file, e.g. correspondence bw t-1 and t, effyr==t */
.         
.         * exit and entry dummy:
.         gen exit=0
{txt}
{com}.         replace exit=1 if new==""
{txt}(165 real changes made)

{com}.         gen entry=0
{txt}
{com}.         replace entry=1 if obsolete==""
{txt}(154 real changes made)

{com}.         
.         * Identify one-to-many codes:
.                 * Note: for now, these include many-to-many codes, correction below
.         sort effyr obsolete new
{txt}
{com}.         gen temp=1 if obsolete==obsolete[_n-1 ]& new!=new[_n-1] & exit!=1 & entry!=1
{txt}(5980 missing values generated)

{com}.         sort effyr obsolete
{txt}
{com}.         by effyr obsolete: egen one_many=max(temp)
{txt}(5567 missing values generated)

{com}.         replace one_many=0 if one_many==.
{txt}(5567 real changes made)

{com}.         drop temp
{txt}
{com}.         
.         
.         * Identify many-to-one codes:
.                 * Note: for now, these include many-to-many codes, correction below
.         sort effyr new obsolete
{txt}
{com}.         gen temp=1 if new==new[_n-1 ]& obsolete!=obsolete[_n-1] & exit!=1       & entry!=1
{txt}(5041 missing values generated)

{com}.         sort effyr new
{txt}
{com}.         by effyr new: egen many_one=max(temp)
{txt}(4212 missing values generated)

{com}.         replace many_one=0 if many_one==.
{txt}(4212 real changes made)

{com}.         drop temp
{txt}
{com}.         
.         * identify many-to-many codes:
.                 * these have to be assigned unique setyr using loop below
.         gen temp=1 if many_one==1 & one_many==1
{txt}(5986 missing values generated)

{com}.         sort effyr obsolete
{txt}
{com}.         by effyr obsolete: egen temp2=max(temp)
{txt}(5852 missing values generated)

{com}.         sort effyr new
{txt}
{com}.         by effyr new: egen many_many=max(temp2)
{txt}(5639 missing values generated)

{com}.         replace many_many=0 if many_many==.
{txt}(5639 real changes made)

{com}.         replace many_many=0 if exit==1 | entry==1
{txt}(65 real changes made)

{com}.         replace one_many=0 if exit==1 | entry==1
{txt}(24 real changes made)

{com}.         replace many_one=0 if exit==1 | entry==1
{txt}(22 real changes made)

{com}.         
.         * Identify simple codes:
.         gen simple=0
{txt}
{com}.         replace simple=1 if many_many==0 & one_many==0 & many_one==0 & exit==0 & entry==0
{txt}(3520 real changes made)

{com}.         
.         * Correction one-to-many and many-to-one coding:
.                 * many-to-many codes need to be taken out.
.         replace one_many=0 if many_many==1
{txt}(722 real changes made)

{com}.         replace many_one=0 if many_many==1
{txt}(750 real changes made)

{com}. 
.         * check: sum of simple, one-many, many-one, many-many, exit and entry should equal 1 (not more, not less):
.         drop temp temp2
{txt}
{com}.         egen temp=rowtotal(simple one_many many_one many_many exit entry)
{txt}
{com}.         tab temp

       {txt}temp {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      6,581      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      6,581      100.00
{txt}
{com}.         
. save temp, replace
{txt}file temp.dta saved

{com}. tab effyr

      {txt}effyr {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
       1994 {c |}{res}         50        0.76        0.76
{txt}       1995 {c |}{res}         71        1.08        1.84
{txt}       1996 {c |}{res}        145        2.20        4.04
{txt}       1998 {c |}{res}          2        0.03        4.07
{txt}       1999 {c |}{res}        129        1.96        6.03
{txt}       2000 {c |}{res}         21        0.32        6.35
{txt}       2001 {c |}{res}        132        2.01        8.36
{txt}       2002 {c |}{res}        122        1.85       10.21
{txt}       2003 {c |}{res}        543        8.25       18.46
{txt}       2004 {c |}{res}         44        0.67       19.13
{txt}       2005 {c |}{res}        313        4.76       23.89
{txt}       2006 {c |}{res}          4        0.06       23.95
{txt}       2007 {c |}{res}        287        4.36       28.31
{txt}       2008 {c |}{res}      4,639       70.49       98.80
{txt}       2009 {c |}{res}         29        0.44       99.24
{txt}       2010 {c |}{res}         50        0.76      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      6,581      100.00
{txt}
{com}. 
. 
. **************************************************************  
. *** Step 2: Generate setyr's for changes between t and t-1 ***
. **************************************************************
. * Loop 1        
. * Generate setyr's that will be used to verify feedback effects
. * for many-many mappings between t and t-1
.                 
. * define the relevant numlist
. * why: there are no change in PC8 in some years, need to take this into account
. 
. if `b'!=1996 {c -(}
.         keep if effyr >= `b1' & effyr <= `e'
{txt}(0 observations deleted)
{com}.         levelsof effyr, local(pcyr)     
{txt}1994 1995 1996 1998 1999 2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010
{com}.         * we also need local with effyr's +1 (like b and b1)
.                 gen effyr1 = effyr 
.                 replace effyr1 = . if effyr == `b1'
{txt}(50 real changes made, 50 to missing)
{com}.                 tab effyr1

     {txt}effyr1 {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
       1995 {c |}{res}         71        1.09        1.09
{txt}       1996 {c |}{res}        145        2.22        3.31
{txt}       1998 {c |}{res}          2        0.03        3.34
{txt}       1999 {c |}{res}        129        1.98        5.31
{txt}       2000 {c |}{res}         21        0.32        5.63
{txt}       2001 {c |}{res}        132        2.02        7.66
{txt}       2002 {c |}{res}        122        1.87        9.52
{txt}       2003 {c |}{res}        543        8.31       17.84
{txt}       2004 {c |}{res}         44        0.67       18.51
{txt}       2005 {c |}{res}        313        4.79       23.30
{txt}       2006 {c |}{res}          4        0.06       23.37
{txt}       2007 {c |}{res}        287        4.39       27.76
{txt}       2008 {c |}{res}      4,639       71.03       98.79
{txt}       2009 {c |}{res}         29        0.44       99.23
{txt}       2010 {c |}{res}         50        0.77      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      6,531      100.00
{com}.                 levelsof effyr1, local(pcyr1)
{txt}1995 1996 1998 1999 2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010
{com}.         {c )-}
{txt}
{com}. 
. if `b'==1996 {c -(}
.         keep if effyr >= `b1' & effyr <= `e'
.         levelsof effyr, local(pcyr)     
.         * we also need local with effyr's +1 (like b and b1)
.                 gen effyr1 = effyr 
.                 replace effyr1 = . if effyr == `b1'
.                 replace effyr1 = . if effyr == 1998
.                 tab effyr1
.                 levelsof effyr1, local(pcyr1)
.         {c )-}
{txt}
{com}.         
.         
.         foreach yr of local pcyr {c -(}
{txt}  2{com}.                 use temp, clear
{txt}  3{com}.                 keep if effyr==`yr'
{txt}  4{com}.                 
.                 sort effyr one_many many_one
{txt}  5{com}.                         * create groupings for one_many:
.                         egen tmp=group(obsolete) if one_many==1
{txt}  6{com}.         
.                 * create groupings for many_one:
.                         * Numbering needs to start after numbering for one_many:
.                         bysort effyr: egen tmpno=max(tmp)
{txt}  7{com}.                         if tmpno==. {c -(}
{txt}  8{com}.                                 * if there are no 1-M groups
.                                 drop tmpno
{txt}  9{com}.                                 gen tmpno=0
{txt} 10{com}.                                 {c )-}
{txt} 11{com}.                         egen tmp2=group(new) if many_one==1 
{txt} 12{com}.                         gen tmp3=tmpno + tmp2
{txt} 13{com}.                         drop tmpno 
{txt} 14{com}. 
.                 * create groupings for many-many:
.                         bysort effyr: egen tmpno=max(tmp3)
{txt} 15{com}.                         if tmpno==. {c -(}
{txt} 16{com}.                                 * if there are no M-1 groups
.                                 drop tmpno
{txt} 17{com}.                                 egen tmpno=max(tmp)
{txt} 18{com}.                                 {c )-}
{txt} 19{com}.                         if tmpno==. {c -(}
{txt} 20{com}.                                 * if there are no 1-M groups
.                                 drop tmpno
{txt} 21{com}.                                 gen tmpno=0
{txt} 22{com}.                                 {c )-}
{txt} 23{com}. 
.                         egen tmp4=group(obsolete) if many_many==1
{txt} 24{com}.                                 * we could group on new here as well, needs to be checked for feedback effects anyway
.                         gen tmp5=tmpno + tmp4
{txt} 25{com}.                         drop tmpno
{txt} 26{com}. 
.                 * create groupings for simple changes:
.                         bysort effyr: egen tmpno=max(tmp5)
{txt} 27{com}.                         if tmpno==. {c -(}
{txt} 28{com}.                                 * if there are no M-M mappings
.                                 drop tmpno
{txt} 29{com}.                                 egen tmpno=max(tmp3)
{txt} 30{com}.                                 {c )-}
{txt} 31{com}.                         if tmpno==. {c -(}
{txt} 32{com}.                                 * if there are no M-1 groups
.                                 drop tmpno
{txt} 33{com}.                                 egen tmpno=max(tmp)
{txt} 34{com}.                                 {c )-}
{txt} 35{com}.                         if tmpno==. {c -(}
{txt} 36{com}.                                 * if there are no 1-M groups
.                                 drop tmpno
{txt} 37{com}.                                 gen tmpno=0
{txt} 38{com}.                                 {c )-}
{txt} 39{com}.                         egen tmp6=group(obsolete) if simple==1
{txt} 40{com}.                         gen tmp7=tmpno + tmp6
{txt} 41{com}.                         drop tmpno
{txt} 42{com}.         
.                 egen tmp8= rowtotal(tmp tmp3 tmp5 tmp7)
{txt} 43{com}.                 gen tmp9=.`yr'
{txt} 44{com}.                 egen code=concat(tmp8 tmp9)
{txt} 45{com}.                 destring code, replace
{txt} 46{com}.                 drop tmp tmp2-tmp9 temp 
{txt} 47{com}.                 
.                 * obsolete and new codes need to numeric
.                         destring obsolete, g(obsoletenum)
{txt} 48{com}.                         destring new, g(newnum)
{txt} 49{com}. 
.                 
.                 keep effyr obsolete new exit entry one_many many_one many_many simple obsoletenum newnum code
{txt} 50{com}.                 
.                 save temp_`yr', replace
{txt} 51{com}.                 {c )-}
{txt}(6531 observations deleted)
(24 missing values generated)
(50 missing values generated)
(50 missing values generated)
(50 missing values generated)
(50 missing values generated)
(50 missing values generated)
(50 missing values generated)
(50 missing values generated)
(33 missing values generated)
(33 missing values generated)
code has all characters numeric; {res}replaced {txt}as {res}double
{txt}obsolete has all characters numeric; obsoletenum {res}generated {txt}as {res}long
{txt}(3 missing values generated)
new has all characters numeric; newnum {res}generated {txt}as {res}long
{txt}(4 missing values generated)
(note: file temp_1994.dta not found)
file temp_1994.dta saved
(6510 observations deleted)
(60 missing values generated)
(71 missing values generated)
(71 missing values generated)
(71 missing values generated)
(71 missing values generated)
(71 missing values generated)
(71 missing values generated)
(71 missing values generated)
(59 missing values generated)
(59 missing values generated)
code has all characters numeric; {res}replaced {txt}as {res}double
{txt}obsolete has all characters numeric; obsoletenum {res}generated {txt}as {res}long
{txt}(29 missing values generated)
new has all characters numeric; newnum {res}generated {txt}as {res}long
{txt}(19 missing values generated)
(note: file temp_1995.dta not found)
file temp_1995.dta saved
(6436 observations deleted)
(139 missing values generated)
(76 missing values generated)
(76 missing values generated)
(116 missing values generated)
(116 missing values generated)
(133 missing values generated)
(133 missing values generated)
code has all characters numeric; {res}replaced {txt}as {res}double
{txt}obsolete has all characters numeric; obsoletenum {res}generated {txt}as {res}long
{txt}(15 missing values generated)
new has all characters numeric; newnum {res}generated {txt}as {res}long
{txt}(14 missing values generated)
(note: file temp_1996.dta not found)
file temp_1996.dta saved
(6579 observations deleted)
(2 missing values generated)
(2 missing values generated)
(2 missing values generated)
(2 missing values generated)
(2 missing values generated)
(2 missing values generated)
(2 missing values generated)
(2 missing values generated)
(2 missing values generated)
(2 missing values generated)
(2 missing values generated)
(2 missing values generated)
(2 missing values generated)
code has all characters numeric; {res}replaced {txt}as {res}double
{txt}obsolete has all characters numeric; obsoletenum {res}generated {txt}as {res}long
{txt}new has all characters numeric; newnum {res}generated {txt}as {res}byte
{txt}(2 missing values generated)
(note: file temp_1998.dta not found)
file temp_1998.dta saved
(6452 observations deleted)
(129 missing values generated)
(129 missing values generated)
(67 missing values generated)
(67 missing values generated)
(127 missing values generated)
(127 missing values generated)
(127 missing values generated)
(127 missing values generated)
code has all characters numeric; {res}replaced {txt}as {res}double
{txt}obsolete has all characters numeric; obsoletenum {res}generated {txt}as {res}long
{txt}(60 missing values generated)
new has all characters numeric; newnum {res}generated {txt}as {res}long
{txt}(3 missing values generated)
(note: file temp_1999.dta not found)
file temp_1999.dta saved
(6560 observations deleted)
(17 missing values generated)
(11 missing values generated)
(11 missing values generated)
(15 missing values generated)
(15 missing values generated)
(20 missing values generated)
(20 missing values generated)
code has all characters numeric; {res}replaced {txt}as {res}double
{txt}obsolete has all characters numeric; obsoletenum {res}generated {txt}as {res}long
{txt}new has all characters numeric; newnum {res}generated {txt}as {res}long
{txt}(note: file temp_2000.dta not found)
file temp_2000.dta saved
(6449 observations deleted)
(113 missing values generated)
(30 missing values generated)
(30 missing values generated)
(121 missing values generated)
(121 missing values generated)
(132 missing values generated)
(132 missing values generated)
code has all characters numeric; {res}replaced {txt}as {res}double
{txt}obsolete has all characters numeric; obsoletenum {res}generated {txt}as {res}long
{txt}new has all characters numeric; newnum {res}generated {txt}as {res}long
{txt}(note: file temp_2001.dta not found)
file temp_2001.dta saved
(6459 observations deleted)
(118 missing values generated)
(88 missing values generated)
(88 missing values generated)
(44 missing values generated)
(44 missing values generated)
(119 missing values generated)
(119 missing values generated)
code has all characters numeric; {res}replaced {txt}as {res}double
{txt}obsolete has all characters numeric; obsoletenum {res}generated {txt}as {res}long
{txt}(3 missing values generated)
new has all characters numeric; newnum {res}generated {txt}as {res}long
{txt}(note: file temp_2002.dta not found)
file temp_2002.dta saved
(6038 observations deleted)
(524 missing values generated)
(521 missing values generated)
(521 missing values generated)
(243 missing values generated)
(243 missing values generated)
(354 missing values generated)
(354 missing values generated)
code has all characters numeric; {res}replaced {txt}as {res}double
{txt}obsolete has all characters numeric; obsoletenum {res}generated {txt}as {res}long
{txt}(12 missing values generated)
new has all characters numeric; newnum {res}generated {txt}as {res}long
{txt}(1 missing value generated)
(note: file temp_2003.dta not found)
file temp_2003.dta saved
(6537 observations deleted)
(42 missing values generated)
(22 missing values generated)
(22 missing values generated)
(28 missing values generated)
(28 missing values generated)
(43 missing values generated)
(43 missing values generated)
code has all characters numeric; {res}replaced {txt}as {res}double
{txt}obsolete has all characters numeric; obsoletenum {res}generated {txt}as {res}long
{txt}(2 missing values generated)
new has all characters numeric; newnum {res}generated {txt}as {res}long
{txt}(1 missing value generated)
(note: file temp_2004.dta not found)
file temp_2004.dta saved
(6268 observations deleted)
(297 missing values generated)
(89 missing values generated)
(89 missing values generated)
(313 missing values generated)
(313 missing values generated)
(313 missing values generated)
(306 missing values generated)
(306 missing values generated)
code has all characters numeric; {res}replaced {txt}as {res}double
{txt}obsolete has all characters numeric; obsoletenum {res}generated {txt}as {res}long
{txt}(1 missing value generated)
new has all characters numeric; newnum {res}generated {txt}as {res}long
{txt}(65 missing values generated)
(note: file temp_2005.dta not found)
file temp_2005.dta saved
(6577 observations deleted)
(4 missing values generated)
(4 missing values generated)
(4 missing values generated)
(4 missing values generated)
(4 missing values generated)
(4 missing values generated)
(4 missing values generated)
code has all characters numeric; {res}replaced {txt}as {res}double
{txt}obsolete has all characters numeric; obsoletenum {res}generated {txt}as {res}long
{txt}new has all characters numeric; newnum {res}generated {txt}as {res}long
{txt}(note: file temp_2006.dta not found)
file temp_2006.dta saved
(6294 observations deleted)
(270 missing values generated)
(184 missing values generated)
(184 missing values generated)
(145 missing values generated)
(145 missing values generated)
(274 missing values generated)
(274 missing values generated)
code has all characters numeric; {res}replaced {txt}as {res}double
{txt}obsolete has all characters numeric; obsoletenum {res}generated {txt}as {res}long
{txt}(9 missing values generated)
new has all characters numeric; newnum {res}generated {txt}as {res}long
{txt}(3 missing values generated)
(note: file temp_2007.dta not found)
file temp_2007.dta saved
(1942 observations deleted)
(4499 missing values generated)
(3756 missing values generated)
(3756 missing values generated)
(4352 missing values generated)
(4352 missing values generated)
(1381 missing values generated)
(1381 missing values generated)
code has all characters numeric; {res}replaced {txt}as {res}double
{txt}obsolete has all characters numeric; obsoletenum {res}generated {txt}as {res}long
{txt}(19 missing values generated)
new has all characters numeric; newnum {res}generated {txt}as {res}long
{txt}(52 missing values generated)
(note: file temp_2008.dta not found)
file temp_2008.dta saved
(6552 observations deleted)
(29 missing values generated)
(29 missing values generated)
(3 missing values generated)
(3 missing values generated)
(29 missing values generated)
(29 missing values generated)
(29 missing values generated)
(28 missing values generated)
(28 missing values generated)
code has all characters numeric; {res}replaced {txt}as {res}double
{txt}obsolete has all characters numeric; obsoletenum {res}generated {txt}as {res}long
{txt}(1 missing value generated)
new has all characters numeric; newnum {res}generated {txt}as {res}long
{txt}(1 missing value generated)
(note: file temp_2009.dta not found)
file temp_2009.dta saved
(6531 observations deleted)
(46 missing values generated)
(14 missing values generated)
(14 missing values generated)
(44 missing values generated)
(44 missing values generated)
(46 missing values generated)
(46 missing values generated)
code has all characters numeric; {res}replaced {txt}as {res}double
{txt}obsolete has all characters numeric; obsoletenum {res}generated {txt}as {res}long
{txt}new has all characters numeric; newnum {res}generated {txt}as {res}long
{txt}(note: file temp_2010.dta not found)
file temp_2010.dta saved

{com}.         
.         
.                 
. * loop to identify feedback effects M-M groupings within a year 
.         * For now, we ignore entry and exit codes (changes in coverage over time)
.                 * Based on Pierce and Schott (2012)
.         * Explanation of loop:
.                 * function mod(`zzz', 2) is used to switch even and odd turns in the loop
.                 * modulus(x,y) = x - y * int(x/y)
.                 * equal to 0 if zzz=2, 4, 6, 8, ... 
.                 * different from 0 for zzz=3, 5, 7, ...
.                 * each time the setyr's are grouped by new or obsolete
.                 * equivalent to sorting in excel by new and obsolete
.                 * to identify feedback effects
.          
. foreach yr of local pcyr {c -(}
{txt}  2{com}.          
.          use temp_`yr', clear
{txt}  3{com}. 
.          bysort new: egen c1 = min(code)
{txt}  4{com}.                 * assign min setyr by new (we grouped by obsolete above for M-M)
.                  local zzz = 2
{txt}  5{com}.                  local stop = 0
{txt}  6{com}.                  while `stop'==0 {c -(}
{txt}  7{com}.                  noisily display [`zzz']
{txt}  8{com}.                  local zlag = `zzz'-1
{txt}  9{com}.                  if mod(`zzz',2)==0 {c -(}
{txt} 10{com}.                         bysort obsolete: egen c`zzz'= min(c`zlag')
{txt} 11{com}.                   {c )-}
{txt} 12{com}.                  if mod(`zzz',2)~=0 {c -(}
{txt} 13{com}.                         bysort new: egen c`zzz'= min(c`zlag')
{txt} 14{com}.                   {c )-}
{txt} 15{com}.          
.                  compare c`zzz' c`zlag'
{txt} 16{com}.                  gen idx = c`zzz'==c`zlag'
{txt} 17{com}.                  tab idx
{txt} 18{com}.                  local stop = r(r)==1
{txt} 19{com}.                  local zzz = `zzz'+1
{txt} 20{com}.                  display r(r) " " [`stop']
{txt} 21{com}.                  drop idx
{txt} 22{com}.                  {c )-}
{txt} 23{com}.   
.         local yyy = `zzz' - 1
{txt} 24{com}.         gen setyr = c`yyy'
{txt} 25{com}.         drop c1-c`yyy'
{txt} 26{com}.  
. * Verify coding:
. 
.        sort new 
{txt} 27{com}.        count if new==new[_n-1] & setyr!=setyr[_n-1]
{txt} 28{com}.  
.        sort obsolete
{txt} 29{com}.        count if obsolete==obsolete[_n-1] & setyr!=setyr[_n-1]
{txt} 30{com}.   
. * recode, so setyr are numbered consecutively 
.        sort effyr setyr
{txt} 31{com}.        egen group=group(setyr)
{txt} 32{com}.        gen tmp=.
{txt} 33{com}.        egen tmp2=concat(group tmp effyr)
{txt} 34{com}.        destring tmp2, gen(setyr2)
{txt} 35{com}.        drop setyr tmp tmp2
{txt} 36{com}.        rename setyr2 setyr
{txt} 37{com}.  
. * prepare file for subsequent analysis:
.         drop code
{txt} 38{com}.         format setyr %9.4fc
{txt} 39{com}.         sort obsoletenum newnum effyr 
{txt} 40{com}. save temp2_`yr', replace
{txt} 41{com}.         rename newnum new`yr'
{txt} 42{com}.         rename obsoletenum obs`yr'
{txt} 43{com}.         rename setyr setyr`yr'
{txt} 44{com}.         rename effyr effyr`yr'
{txt} 45{com}.         order obs`yr' new`yr'
{txt} 46{com}.         sort obs`yr'
{txt} 47{com}.                         
. save temp_xchain_`yr', replace
{txt} 48{com}. {c )-}
2

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c2=c1                   {res}       50
{txt}{col 24}{hline 10}
jointly defined         {res}       50             0            0           0
{txt}{col 24}{hline 10}
total                   {res}       50

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}         50      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}         50      100.00
1 1
    1
    1
{txt}(50 missing values generated)
tmp2 has all characters numeric; setyr2 {res}generated {txt}as {res}double
{txt}(note: file temp2_1994.dta not found)
file temp2_1994.dta saved
(note: file temp_xchain_1994.dta not found)
file temp_xchain_1994.dta saved
2

{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c2<c1                   {res}        7            -8    -4.857143          -1
{txt}c2=c1                   {res}       64
{txt}{col 24}{hline 10}
jointly defined         {res}       71            -8    -.4788732           0
{txt}{col 24}{hline 10}
total                   {res}       71

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}          7        9.86        9.86
{txt}          1 {c |}{res}         64       90.14      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}         71      100.00
2 0
3

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c3=c2                   {res}       71
{txt}{col 24}{hline 10}
jointly defined         {res}       71             0            0           0
{txt}{col 24}{hline 10}
total                   {res}       71

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}         71      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}         71      100.00
1 1
    1
    1
{txt}(71 missing values generated)
tmp2 has all characters numeric; setyr2 {res}generated {txt}as {res}double
{txt}(note: file temp2_1995.dta not found)
file temp2_1995.dta saved
(note: file temp_xchain_1995.dta not found)
file temp_xchain_1995.dta saved
2

{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c2<c1                   {res}        4            -1           -1          -1
{txt}c2=c1                   {res}      141
{txt}{col 24}{hline 10}
jointly defined         {res}      145            -1    -.0275862           0
{txt}{col 24}{hline 10}
total                   {res}      145

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}          4        2.76        2.76
{txt}          1 {c |}{res}        141       97.24      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        145      100.00
2 0
3

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c3<c2                   {res}        3            -1           -1          -1
{txt}c3=c2                   {res}      142
{txt}{col 24}{hline 10}
jointly defined         {res}      145            -1    -.0206897           0
{txt}{col 24}{hline 10}
total                   {res}      145

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}          3        2.07        2.07
{txt}          1 {c |}{res}        142       97.93      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        145      100.00
2 0
4

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c4=c3                   {res}      145
{txt}{col 24}{hline 10}
jointly defined         {res}      145             0            0           0
{txt}{col 24}{hline 10}
total                   {res}      145

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}        145      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        145      100.00
1 1
    1
    1
{txt}(145 missing values generated)
tmp2 has all characters numeric; setyr2 {res}generated {txt}as {res}double
{txt}(note: file temp2_1996.dta not found)
file temp2_1996.dta saved
(note: file temp_xchain_1996.dta not found)
file temp_xchain_1996.dta saved
2

{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c2=c1                   {res}        2
{txt}{col 24}{hline 10}
jointly defined         {res}        2             0            0           0
{txt}{col 24}{hline 10}
total                   {res}        2

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}          2      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}          2      100.00
1 1
    1
    0
{txt}(2 missing values generated)
tmp2 has all characters numeric; setyr2 {res}generated {txt}as {res}double
{txt}(note: file temp2_1998.dta not found)
file temp2_1998.dta saved
(note: file temp_xchain_1998.dta not found)
file temp_xchain_1998.dta saved
2

{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c2=c1                   {res}      129
{txt}{col 24}{hline 10}
jointly defined         {res}      129             0            0           0
{txt}{col 24}{hline 10}
total                   {res}      129

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}        129      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        129      100.00
1 1
    1
    1
{txt}(129 missing values generated)
tmp2 has all characters numeric; setyr2 {res}generated {txt}as {res}double
{txt}(note: file temp2_1999.dta not found)
file temp2_1999.dta saved
(note: file temp_xchain_1999.dta not found)
file temp_xchain_1999.dta saved
2

{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c2<c1                   {res}        1            -1           -1          -1
{txt}c2=c1                   {res}       20
{txt}{col 24}{hline 10}
jointly defined         {res}       21            -1     -.047619           0
{txt}{col 24}{hline 10}
total                   {res}       21

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}          1        4.76        4.76
{txt}          1 {c |}{res}         20       95.24      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}         21      100.00
2 0
3

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c3=c2                   {res}       21
{txt}{col 24}{hline 10}
jointly defined         {res}       21             0            0           0
{txt}{col 24}{hline 10}
total                   {res}       21

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}         21      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}         21      100.00
1 1
    0
    0
{txt}(21 missing values generated)
tmp2 has all characters numeric; setyr2 {res}generated {txt}as {res}double
{txt}(note: file temp2_2000.dta not found)
file temp2_2000.dta saved
(note: file temp_xchain_2000.dta not found)
file temp_xchain_2000.dta saved
2

{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c2<c1                   {res}        2            -1           -1          -1
{txt}c2=c1                   {res}      130
{txt}{col 24}{hline 10}
jointly defined         {res}      132            -1    -.0151515           0
{txt}{col 24}{hline 10}
total                   {res}      132

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}          2        1.52        1.52
{txt}          1 {c |}{res}        130       98.48      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        132      100.00
2 0
3

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c3=c2                   {res}      132
{txt}{col 24}{hline 10}
jointly defined         {res}      132             0            0           0
{txt}{col 24}{hline 10}
total                   {res}      132

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}        132      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        132      100.00
1 1
    0
    0
{txt}(132 missing values generated)
tmp2 has all characters numeric; setyr2 {res}generated {txt}as {res}double
{txt}(note: file temp2_2001.dta not found)
file temp2_2001.dta saved
(note: file temp_xchain_2001.dta not found)
file temp_xchain_2001.dta saved
2

{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c2<c1                   {res}       18            -6    -3.277778          -1
{txt}c2=c1                   {res}      104
{txt}{col 24}{hline 10}
jointly defined         {res}      122            -6    -.4836066           0
{txt}{col 24}{hline 10}
total                   {res}      122

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}         18       14.75       14.75
{txt}          1 {c |}{res}        104       85.25      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        122      100.00
2 0
3

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c3<c2                   {res}       13            -6    -2.307692          -1
{txt}c3=c2                   {res}      109
{txt}{col 24}{hline 10}
jointly defined         {res}      122            -6    -.2459016           0
{txt}{col 24}{hline 10}
total                   {res}      122

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}         13       10.66       10.66
{txt}          1 {c |}{res}        109       89.34      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        122      100.00
2 0
4

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c4<c3                   {res}        1            -1           -1          -1
{txt}c4=c3                   {res}      121
{txt}{col 24}{hline 10}
jointly defined         {res}      122            -1    -.0081967           0
{txt}{col 24}{hline 10}
total                   {res}      122

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}          1        0.82        0.82
{txt}          1 {c |}{res}        121       99.18      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        122      100.00
2 0
5

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c5<c4                   {res}        2            -1           -1          -1
{txt}c5=c4                   {res}      120
{txt}{col 24}{hline 10}
jointly defined         {res}      122            -1    -.0163934           0
{txt}{col 24}{hline 10}
total                   {res}      122

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}          2        1.64        1.64
{txt}          1 {c |}{res}        120       98.36      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        122      100.00
2 0
6

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c6<c5                   {res}        2            -1           -1          -1
{txt}c6=c5                   {res}      120
{txt}{col 24}{hline 10}
jointly defined         {res}      122            -1    -.0163934           0
{txt}{col 24}{hline 10}
total                   {res}      122

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}          2        1.64        1.64
{txt}          1 {c |}{res}        120       98.36      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        122      100.00
2 0
7

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c7<c6                   {res}        2            -1           -1          -1
{txt}c7=c6                   {res}      120
{txt}{col 24}{hline 10}
jointly defined         {res}      122            -1    -.0163934           0
{txt}{col 24}{hline 10}
total                   {res}      122

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}          2        1.64        1.64
{txt}          1 {c |}{res}        120       98.36      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        122      100.00
2 0
8

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c8=c7                   {res}      122
{txt}{col 24}{hline 10}
jointly defined         {res}      122             0            0           0
{txt}{col 24}{hline 10}
total                   {res}      122

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}        122      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        122      100.00
1 1
    0
    1
{txt}(122 missing values generated)
tmp2 has all characters numeric; setyr2 {res}generated {txt}as {res}double
{txt}(note: file temp2_2002.dta not found)
file temp2_2002.dta saved
(note: file temp_xchain_2002.dta not found)
file temp_xchain_2002.dta saved
2

{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c2<c1                   {res}      108           -45    -8.620371          -1
{txt}c2=c1                   {res}      435
{txt}{col 24}{hline 10}
jointly defined         {res}      543           -45    -1.714549           0
{txt}{col 24}{hline 10}
total                   {res}      543

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        108       19.89       19.89
{txt}          1 {c |}{res}        435       80.11      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        543      100.00
2 0
3

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c3<c2                   {res}      107           -43    -11.19626          -1
{txt}c3=c2                   {res}      436
{txt}{col 24}{hline 10}
jointly defined         {res}      543           -43    -2.206262           0
{txt}{col 24}{hline 10}
total                   {res}      543

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        107       19.71       19.71
{txt}          1 {c |}{res}        436       80.29      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        543      100.00
2 0
4

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c4<c3                   {res}       65           -41    -11.93846          -1
{txt}c4=c3                   {res}      478
{txt}{col 24}{hline 10}
jointly defined         {res}      543           -41    -1.429098           0
{txt}{col 24}{hline 10}
total                   {res}      543

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}         65       11.97       11.97
{txt}          1 {c |}{res}        478       88.03      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        543      100.00
2 0
5

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c5<c4                   {res}       70           -41        -14.4          -1
{txt}c5=c4                   {res}      473
{txt}{col 24}{hline 10}
jointly defined         {res}      543           -41    -1.856354           0
{txt}{col 24}{hline 10}
total                   {res}      543

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}         70       12.89       12.89
{txt}          1 {c |}{res}        473       87.11      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        543      100.00
2 0
6

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c6<c5                   {res}       40           -18      -15.825          -7
{txt}c6=c5                   {res}      503
{txt}{col 24}{hline 10}
jointly defined         {res}      543           -18    -1.165746           0
{txt}{col 24}{hline 10}
total                   {res}      543

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}         40        7.37        7.37
{txt}          1 {c |}{res}        503       92.63      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        543      100.00
2 0
7

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c7<c6                   {res}       24           -18    -15.95834          -7
{txt}c7=c6                   {res}      519
{txt}{col 24}{hline 10}
jointly defined         {res}      543           -18    -.7053408           0
{txt}{col 24}{hline 10}
total                   {res}      543

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}         24        4.42        4.42
{txt}          1 {c |}{res}        519       95.58      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        543      100.00
2 0
8

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c8<c7                   {res}        8           -18      -16.375          -7
{txt}c8=c7                   {res}      535
{txt}{col 24}{hline 10}
jointly defined         {res}      543           -18    -.2412523           0
{txt}{col 24}{hline 10}
total                   {res}      543

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}          8        1.47        1.47
{txt}          1 {c |}{res}        535       98.53      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        543      100.00
2 0
9

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c9<c8                   {res}        5           -16    -8.800001          -7
{txt}c9=c8                   {res}      538
{txt}{col 24}{hline 10}
jointly defined         {res}      543           -16    -.0810313           0
{txt}{col 24}{hline 10}
total                   {res}      543

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}          5        0.92        0.92
{txt}          1 {c |}{res}        538       99.08      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        543      100.00
2 0
10

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c10<c9                  {res}        7           -16    -8.285715          -7
{txt}c10=c9                  {res}      536
{txt}{col 24}{hline 10}
jointly defined         {res}      543           -16     -.106814           0
{txt}{col 24}{hline 10}
total                   {res}      543

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}          7        1.29        1.29
{txt}          1 {c |}{res}        536       98.71      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        543      100.00
2 0
11

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c11<c10                 {res}        4           -16          -16         -16
{txt}c11=c10                 {res}      539
{txt}{col 24}{hline 10}
jointly defined         {res}      543           -16    -.1178637           0
{txt}{col 24}{hline 10}
total                   {res}      543

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}          4        0.74        0.74
{txt}          1 {c |}{res}        539       99.26      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        543      100.00
2 0
12

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c12<c11                 {res}        6           -16          -16         -16
{txt}c12=c11                 {res}      537
{txt}{col 24}{hline 10}
jointly defined         {res}      543           -16    -.1767956           0
{txt}{col 24}{hline 10}
total                   {res}      543

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}          6        1.10        1.10
{txt}          1 {c |}{res}        537       98.90      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        543      100.00
2 0
13

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c13=c12                 {res}      543
{txt}{col 24}{hline 10}
jointly defined         {res}      543             0            0           0
{txt}{col 24}{hline 10}
total                   {res}      543

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}        543      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        543      100.00
1 1
    1
    1
{txt}(543 missing values generated)
tmp2 has all characters numeric; setyr2 {res}generated {txt}as {res}double
{txt}(note: file temp2_2003.dta not found)
file temp2_2003.dta saved
(note: file temp_xchain_2003.dta not found)
file temp_xchain_2003.dta saved
2

{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c2<c1                   {res}        2            -2         -1.5          -1
{txt}c2=c1                   {res}       42
{txt}{col 24}{hline 10}
jointly defined         {res}       44            -2    -.0681818           0
{txt}{col 24}{hline 10}
total                   {res}       44

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}          2        4.55        4.55
{txt}          1 {c |}{res}         42       95.45      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}         44      100.00
2 0
3

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c3=c2                   {res}       44
{txt}{col 24}{hline 10}
jointly defined         {res}       44             0            0           0
{txt}{col 24}{hline 10}
total                   {res}       44

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}         44      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}         44      100.00
1 1
    1
    1
{txt}(44 missing values generated)
tmp2 has all characters numeric; setyr2 {res}generated {txt}as {res}double
{txt}(note: file temp2_2004.dta not found)
file temp2_2004.dta saved
(note: file temp_xchain_2004.dta not found)
file temp_xchain_2004.dta saved
2

{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c2=c1                   {res}      313
{txt}{col 24}{hline 10}
jointly defined         {res}      313             0            0           0
{txt}{col 24}{hline 10}
total                   {res}      313

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}        313      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        313      100.00
1 1
    1
    1
{txt}(313 missing values generated)
tmp2 has all characters numeric; setyr2 {res}generated {txt}as {res}double
{txt}(note: file temp2_2005.dta not found)
file temp2_2005.dta saved
(note: file temp_xchain_2005.dta not found)
file temp_xchain_2005.dta saved
2

{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c2=c1                   {res}        4
{txt}{col 24}{hline 10}
jointly defined         {res}        4             0            0           0
{txt}{col 24}{hline 10}
total                   {res}        4

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}          4      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}          4      100.00
1 1
    0
    0
{txt}(4 missing values generated)
tmp2 has all characters numeric; setyr2 {res}generated {txt}as {res}double
{txt}(note: file temp2_2006.dta not found)
file temp2_2006.dta saved
(note: file temp_xchain_2006.dta not found)
file temp_xchain_2006.dta saved
2

{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c2<c1                   {res}       50           -86       -15.82          -1
{txt}c2=c1                   {res}      237
{txt}{col 24}{hline 10}
jointly defined         {res}      287           -86    -2.756098           0
{txt}{col 24}{hline 10}
total                   {res}      287

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}         50       17.42       17.42
{txt}          1 {c |}{res}        237       82.58      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        287      100.00
2 0
3

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c3<c2                   {res}       23           -86    -16.86957          -1
{txt}c3=c2                   {res}      264
{txt}{col 24}{hline 10}
jointly defined         {res}      287           -86    -1.351916           0
{txt}{col 24}{hline 10}
total                   {res}      287

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}         23        8.01        8.01
{txt}          1 {c |}{res}        264       91.99      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        287      100.00
2 0
4

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c4<c3                   {res}       10            -7         -1.6          -1
{txt}c4=c3                   {res}      277
{txt}{col 24}{hline 10}
jointly defined         {res}      287            -7    -.0557491           0
{txt}{col 24}{hline 10}
total                   {res}      287

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}         10        3.48        3.48
{txt}          1 {c |}{res}        277       96.52      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        287      100.00
2 0
5

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c5=c4                   {res}      287
{txt}{col 24}{hline 10}
jointly defined         {res}      287             0            0           0
{txt}{col 24}{hline 10}
total                   {res}      287

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}        287      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        287      100.00
1 1
    1
    1
{txt}(287 missing values generated)
tmp2 has all characters numeric; setyr2 {res}generated {txt}as {res}double
{txt}(note: file temp2_2007.dta not found)
file temp2_2007.dta saved
(note: file temp_xchain_2007.dta not found)
file temp_xchain_2007.dta saved
2

{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c2<c1                   {res}       86          -488    -47.52326          -1
{txt}c2=c1                   {res}     4553
{txt}{col 24}{hline 10}
jointly defined         {res}     4639          -488    -.8810088           0
{txt}{col 24}{hline 10}
total                   {res}     4639

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}         86        1.85        1.85
{txt}          1 {c |}{res}      4,553       98.15      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,639      100.00
2 0
3

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c3<c2                   {res}       33          -486    -103.1212          -1
{txt}c3=c2                   {res}     4606
{txt}{col 24}{hline 10}
jointly defined         {res}     4639          -486    -.7335633           0
{txt}{col 24}{hline 10}
total                   {res}     4639

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}         33        0.71        0.71
{txt}          1 {c |}{res}      4,606       99.29      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,639      100.00
2 0
4

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c4<c3                   {res}        5          -482       -385.4          -1
{txt}c4=c3                   {res}     4634
{txt}{col 24}{hline 10}
jointly defined         {res}     4639          -482    -.4153912           0
{txt}{col 24}{hline 10}
total                   {res}     4639

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}          5        0.11        0.11
{txt}          1 {c |}{res}      4,634       99.89      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,639      100.00
2 0
5

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c5<c4                   {res}        3          -482    -481.3333        -481
{txt}c5=c4                   {res}     4636
{txt}{col 24}{hline 10}
jointly defined         {res}     4639          -482     -.311274           0
{txt}{col 24}{hline 10}
total                   {res}     4639

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}          3        0.06        0.06
{txt}          1 {c |}{res}      4,636       99.94      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,639      100.00
2 0
6

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c6<c5                   {res}        2          -482       -481.5        -481
{txt}c6=c5                   {res}     4637
{txt}{col 24}{hline 10}
jointly defined         {res}     4639          -482    -.2075878           0
{txt}{col 24}{hline 10}
total                   {res}     4639

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}          2        0.04        0.04
{txt}          1 {c |}{res}      4,637       99.96      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,639      100.00
2 0
7

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c7=c6                   {res}     4639
{txt}{col 24}{hline 10}
jointly defined         {res}     4639             0            0           0
{txt}{col 24}{hline 10}
total                   {res}     4639

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,639      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,639      100.00
1 1
    1
    1
{txt}(4639 missing values generated)
tmp2 has all characters numeric; setyr2 {res}generated {txt}as {res}double
{txt}(note: file temp2_2008.dta not found)
file temp2_2008.dta saved
(note: file temp_xchain_2008.dta not found)
file temp_xchain_2008.dta saved
2

{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c2=c1                   {res}       29
{txt}{col 24}{hline 10}
jointly defined         {res}       29             0            0           0
{txt}{col 24}{hline 10}
total                   {res}       29

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}         29      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}         29      100.00
1 1
    1
    1
{txt}(29 missing values generated)
tmp2 has all characters numeric; setyr2 {res}generated {txt}as {res}double
{txt}(note: file temp2_2009.dta not found)
file temp2_2009.dta saved
(note: file temp_xchain_2009.dta not found)
file temp_xchain_2009.dta saved
2

{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
c2=c1                   {res}       50
{txt}{col 24}{hline 10}
jointly defined         {res}       50             0            0           0
{txt}{col 24}{hline 10}
total                   {res}       50

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}         50      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}         50      100.00
1 1
    0
    0
{txt}(50 missing values generated)
tmp2 has all characters numeric; setyr2 {res}generated {txt}as {res}double
{txt}(note: file temp2_2010.dta not found)
file temp2_2010.dta saved
(note: file temp_xchain_2010.dta not found)
file temp_xchain_2010.dta saved

{com}. 
. 
. *** Create file for all years between `b' and `e' ***
.          * we need this later on
. 
. 
. if `b1'!=1997 {c -(}                                                   
.         use temp2_`b1', clear
.                         
.                 foreach x of local pcyr1 {c -(}
{txt}  2{com}.                                 append using temp2_`x'
{txt}  3{com}.                         save PC_setyr_`b'_`e', replace
{txt}  4{com}.                         {c )-} 
{txt}(note: file PC_setyr_1993_2010.dta not found)
file PC_setyr_1993_2010.dta saved
file PC_setyr_1993_2010.dta saved
file PC_setyr_1993_2010.dta saved
file PC_setyr_1993_2010.dta saved
file PC_setyr_1993_2010.dta saved
file PC_setyr_1993_2010.dta saved
file PC_setyr_1993_2010.dta saved
file PC_setyr_1993_2010.dta saved
file PC_setyr_1993_2010.dta saved
file PC_setyr_1993_2010.dta saved
file PC_setyr_1993_2010.dta saved
file PC_setyr_1993_2010.dta saved
file PC_setyr_1993_2010.dta saved
file PC_setyr_1993_2010.dta saved
file PC_setyr_1993_2010.dta saved
{com}.         {c )-}
{txt}
{com}.         
. if `b1'==1997 {c -(}                                                   
.         use temp2_1998, clear
.                 foreach x of local pcyr1 {c -(}
{txt}  2{com}.                                 append using temp2_`x'
{txt}  3{com}.                         save PC_setyr_`b'_`e', replace
{txt}  4{com}.                         {c )-} 
.         {c )-}
{txt}
{com}.         
. use PC_setyr_`b'_`e', clear
{txt}
{com}.         duplicates drop

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(5 observations deleted)

{com}.         sort obsoletenum newnum effyr
{txt}
{com}. save PC_setyr_`b'_`e', replace 
{txt}file PC_setyr_1993_2010.dta saved

{com}. 
. * Table 4 of the WP:
.         sort effyr obsoletenum
{txt}
{com}.         table effyr if obsoletenum!=obsoletenum[_n-1], c(count obsoletenum)

{txt}{hline 10}{c TT}{hline 12}
    effyr {c |} N(obsole~m)
{hline 10}{c +}{hline 12}
     1994 {c |}          {res}32
     {txt}1995 {c |}          {res}33
     {txt}1996 {c |}         {res}118
     {txt}1998 {c |}           {res}2
     {txt}1999 {c |}          {res}68
     {txt}2000 {c |}          {res}16
     {txt}2001 {c |}         {res}113
     {txt}2002 {c |}          {res}82
     {txt}2003 {c |}         {res}362
     {txt}2004 {c |}          {res}35
     {txt}2005 {c |}         {res}303
     {txt}2006 {c |}           {res}4
     {txt}2007 {c |}         {res}184
     {txt}2008 {c |}       {res}4,396
     {txt}2009 {c |}          {res}28
     {txt}2010 {c |}          {res}45
{txt}{hline 10}{c BT}{hline 12}

{com}.         sort effyr newnum
{txt}
{com}.         table effyr if newnum!=newnum[_n-1], c(count newnum)

{txt}{hline 10}{c TT}{hline 11}
    effyr {c |}  N(newnum)
{hline 10}{c +}{hline 11}
     1994 {c |}         {res}46
     {txt}1995 {c |}         {res}52
     {txt}1996 {c |}         {res}80
     {txt}1999 {c |}         {res}90
     {txt}2000 {c |}         {res}12
     {txt}2001 {c |}         {res}76
     {txt}2002 {c |}         {res}54
     {txt}2003 {c |}        {res}294
     {txt}2004 {c |}         {res}24
     {txt}2005 {c |}        {res}105
     {txt}2006 {c |}          {res}2
     {txt}2007 {c |}        {res}131
     {txt}2008 {c |}      {res}3,864
     {txt}2009 {c |}         {res}15
     {txt}2010 {c |}         {res}26
{txt}{hline 10}{c BT}{hline 11}

{com}.         sort effyr setyr
{txt}
{com}.         table effyr if setyr!=setyr[_n-1], c(count setyr)

{txt}{hline 10}{c TT}{hline 11}
    effyr {c |}   N(setyr)
{hline 10}{c +}{hline 11}
     1994 {c |}         {res}29
     {txt}1995 {c |}         {res}15
     {txt}1996 {c |}         {res}54
     {txt}1998 {c |}          {res}1
     {txt}1999 {c |}         {res}31
     {txt}2000 {c |}          {res}9
     {txt}2001 {c |}         {res}57
     {txt}2002 {c |}         {res}30
     {txt}2003 {c |}        {res}214
     {txt}2004 {c |}         {res}17
     {txt}2005 {c |}         {res}96
     {txt}2006 {c |}          {res}2
     {txt}2007 {c |}         {res}76
     {txt}2008 {c |}      {res}3,651
     {txt}2009 {c |}         {res}15
     {txt}2010 {c |}         {res}23
{txt}{hline 10}{c BT}{hline 11}

{com}.         table effyr, c(sum simple sum exit sum entry)

{txt}{hline 10}{c TT}{hline 38}
    effyr {c |} sum(simple)    sum(exit)   sum(entry)
{hline 10}{c +}{hline 38}
     1994 {c |}          {res}17            4            3
     {txt}1995 {c |}          {res}12           19           29
     {txt}1996 {c |}          {res}12           14           15
     {txt}1998 {c |}           {res}0            2            0
     {txt}1999 {c |}           {res}2            3           60
     {txt}2000 {c |}           {res}1            0            0
     {txt}2001 {c |}           {res}0            0            0
     {txt}2002 {c |}           {res}3            0            3
     {txt}2003 {c |}         {res}189            1           12
     {txt}2004 {c |}           {res}1            1            2
     {txt}2005 {c |}           {res}7           65            1
     {txt}2006 {c |}           {res}0            0            0
     {txt}2007 {c |}          {res}13            3            9
     {txt}2008 {c |}        {res}3258           52           19
     {txt}2009 {c |}           {res}1            1            1
     {txt}2010 {c |}           {res}4            0            0
{txt}{hline 10}{c BT}{hline 38}

{com}.         
. 
. *********************************************************       
. *** Step 3: Consistent panel over time (procedure PS) ***
. *********************************************************       
. * This procedure is almost identical to that of Schott and Pierce (2009)
. * Loop 2 (news loop PS) 
.                 
.         *** Chains over time: identify them ***
.         * Use the yearly concordance files to chain the obs-new matches across years.
.         * the goal is to find news from subsequent years that modifies news from earlier years
.         * the files generated below only contain chains, not changes that only affect single years
.         * we still ignore entry and exit here (dropped from the data and kept in a separate file for now)
. 
.         
.         foreach y of local pcyr {c -(}
{txt}  2{com}.                 use temp_xchain_`y', clear
{txt}  3{com}.                         keep if exit==1 | entry==1
{txt}  4{com}.                         save temp_exit_entry_`y', replace
{txt}  5{com}.                 use temp_xchain_`y', clear
{txt}  6{com}.                         drop if exit==1 | entry==1
{txt}  7{com}.                         drop exit entry one_many many_one many_many simple obsolete new
{txt}  8{com}.                         rename obs`y' obs
{txt}  9{com}.                         foreach x of local pcyr {c -(}
{txt} 10{com}.                                 if `x'>`y' {c -(}
{txt} 11{com}.                                         noisily display [`y'] " " [`x']
{txt} 12{com}.                                         rename new`y' obs`x'
{txt} 13{com}.                                         sort obs`x'
{txt} 14{com}.                                         joinby obs`x' using temp_xchain_`x', unmatched(master)
{txt} 15{com}.                                         noisily tab _merge
{txt} 16{com}.                                         drop if _merge==2
{txt} 17{com}.                                         rename _merge _m`y'`x'
{txt} 18{com}.                                         rename obs`x' new`y'
{txt} 19{com}.                                         {c )-}
{txt} 20{com}.                         {c )-}
{txt} 21{com}.                         
.                         gen _mjunk=0
{txt} 22{com}.                         egen idx = rowmax(_m*)
{txt} 23{com}.                         noisily tab idx
{txt} 24{com}.                         keep if idx==3
{txt} 25{com}.                         sort obs
{txt} 26{com}.                         drop _m*
{txt} 27{com}.                 save temp2_xchain_`y', replace
{txt} 28{com}.         {c )-}
{txt}(43 observations deleted)
(note: file temp_exit_entry_1994.dta not found)
file temp_exit_entry_1994.dta saved
(7 observations deleted)
1994 1995

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         43      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         43      100.00
{txt}(0 observations deleted)
1994 1996

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         40       93.02       93.02
{txt}both in master and using data {c |}{res}          3        6.98      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         43      100.00
{txt}(0 observations deleted)
1994 1998

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         43      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         43      100.00
{txt}(0 observations deleted)
1994 1999

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         43      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         43      100.00
{txt}(0 observations deleted)
1994 2000

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         43      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         43      100.00
{txt}(0 observations deleted)
1994 2001

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         43      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         43      100.00
{txt}(0 observations deleted)
1994 2002

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         43      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         43      100.00
{txt}(0 observations deleted)
1994 2003

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         40       93.02       93.02
{txt}both in master and using data {c |}{res}          3        6.98      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         43      100.00
{txt}(0 observations deleted)
1994 2004

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         40       93.02       93.02
{txt}both in master and using data {c |}{res}          3        6.98      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         43      100.00
{txt}(0 observations deleted)
1994 2005

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         43      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         43      100.00
{txt}(0 observations deleted)
1994 2006

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         43      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         43      100.00
{txt}(0 observations deleted)
1994 2007

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         43      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         43      100.00
{txt}(0 observations deleted)
1994 2008

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}          9       20.45       20.45
{txt}both in master and using data {c |}{res}         35       79.55      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         44      100.00
{txt}(0 observations deleted)
1994 2009

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         44      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         44      100.00
{txt}(0 observations deleted)
1994 2010

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         44      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         44      100.00
{txt}(0 observations deleted)

        idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          3 {c |}{res}         44      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}         44      100.00
{txt}(0 observations deleted)
(note: file temp2_xchain_1994.dta not found)
file temp2_xchain_1994.dta saved
(23 observations deleted)
(note: file temp_exit_entry_1995.dta not found)
file temp_exit_entry_1995.dta saved
(48 observations deleted)
1995 1996

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         23      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         23      100.00
{txt}(0 observations deleted)
1995 1998

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         23      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         23      100.00
{txt}(0 observations deleted)
1995 1999

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         23      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         23      100.00
{txt}(0 observations deleted)
1995 2000

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         23      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         23      100.00
{txt}(0 observations deleted)
1995 2001

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         22       91.67       91.67
{txt}both in master and using data {c |}{res}          2        8.33      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         24      100.00
{txt}(0 observations deleted)
1995 2002

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         23       92.00       92.00
{txt}both in master and using data {c |}{res}          2        8.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         25      100.00
{txt}(0 observations deleted)
1995 2003

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         25      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         25      100.00
{txt}(0 observations deleted)
1995 2004

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         25      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         25      100.00
{txt}(0 observations deleted)
1995 2005

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         25      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         25      100.00
{txt}(0 observations deleted)
1995 2006

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         25      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         25      100.00
{txt}(0 observations deleted)
1995 2007

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         25      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         25      100.00
{txt}(0 observations deleted)
1995 2008

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}          4       16.00       16.00
{txt}both in master and using data {c |}{res}         21       84.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         25      100.00
{txt}(0 observations deleted)
1995 2009

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         25      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         25      100.00
{txt}(0 observations deleted)
1995 2010

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         25      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         25      100.00
{txt}(0 observations deleted)

        idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          3 {c |}{res}         25      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}         25      100.00
{txt}(0 observations deleted)
(note: file temp2_xchain_1995.dta not found)
file temp2_xchain_1995.dta saved
(116 observations deleted)
(note: file temp_exit_entry_1996.dta not found)
file temp_exit_entry_1996.dta saved
(29 observations deleted)
1996 1998

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        116      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        116      100.00
{txt}(0 observations deleted)
1996 1999

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        108       91.53       91.53
{txt}both in master and using data {c |}{res}         10        8.47      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        118      100.00
{txt}(0 observations deleted)
1996 2000

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        118      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        118      100.00
{txt}(0 observations deleted)
1996 2001

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        118      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        118      100.00
{txt}(0 observations deleted)
1996 2002

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        109       83.21       83.21
{txt}both in master and using data {c |}{res}         22       16.79      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        131      100.00
{txt}(0 observations deleted)
1996 2003

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        126       96.18       96.18
{txt}both in master and using data {c |}{res}          5        3.82      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        131      100.00
{txt}(0 observations deleted)
1996 2004

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        128       93.43       93.43
{txt}both in master and using data {c |}{res}          9        6.57      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        137      100.00
{txt}(0 observations deleted)
1996 2005

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        137      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        137      100.00
{txt}(0 observations deleted)
1996 2006

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        137      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        137      100.00
{txt}(0 observations deleted)
1996 2007

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        127       85.23       85.23
{txt}both in master and using data {c |}{res}         22       14.77      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        149      100.00
{txt}(0 observations deleted)
1996 2008

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         68       43.04       43.04
{txt}both in master and using data {c |}{res}         90       56.96      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        158      100.00
{txt}(0 observations deleted)
1996 2009

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        158      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        158      100.00
{txt}(0 observations deleted)
1996 2010

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        158      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        158      100.00
{txt}(0 observations deleted)

        idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          3 {c |}{res}        158      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        158      100.00
{txt}(0 observations deleted)
(note: file temp2_xchain_1996.dta not found)
file temp2_xchain_1996.dta saved
(0 observations deleted)
(note: file temp_exit_entry_1998.dta not found)
file temp_exit_entry_1998.dta saved
(2 observations deleted)
1998 1999
(joinby on obs1999 is empty)
no observations
(0 observations deleted)
1998 2000
(joinby on obs2000 is empty)
no observations
(0 observations deleted)
1998 2001
(joinby on obs2001 is empty)
no observations
(0 observations deleted)
1998 2002
(joinby on obs2002 is empty)
no observations
(0 observations deleted)
1998 2003
(joinby on obs2003 is empty)
no observations
(0 observations deleted)
1998 2004
(joinby on obs2004 is empty)
no observations
(0 observations deleted)
1998 2005
(joinby on obs2005 is empty)
no observations
(0 observations deleted)
1998 2006
(joinby on obs2006 is empty)
no observations
(0 observations deleted)
1998 2007
(joinby on obs2007 is empty)
no observations
(0 observations deleted)
1998 2008
(joinby on obs2008 is empty)
no observations
(0 observations deleted)
1998 2009
(joinby on obs2009 is empty)
no observations
(0 observations deleted)
1998 2010
(joinby on obs2010 is empty)
no observations
(0 observations deleted)
no observations
(0 observations deleted)
(note: dataset contains 0 observations)
(note: file temp2_xchain_1998.dta not found)
file temp2_xchain_1998.dta saved
(66 observations deleted)
(note: file temp_exit_entry_1999.dta not found)
file temp_exit_entry_1999.dta saved
(63 observations deleted)
1999 2000

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         66      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         66      100.00
{txt}(0 observations deleted)
1999 2001

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         66      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         66      100.00
{txt}(0 observations deleted)
1999 2002

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         63       95.45       95.45
{txt}both in master and using data {c |}{res}          3        4.55      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         66      100.00
{txt}(0 observations deleted)
1999 2003

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         54       81.82       81.82
{txt}both in master and using data {c |}{res}         12       18.18      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         66      100.00
{txt}(0 observations deleted)
1999 2004

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         66      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         66      100.00
{txt}(0 observations deleted)
1999 2005

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         64       96.97       96.97
{txt}both in master and using data {c |}{res}          2        3.03      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         66      100.00
{txt}(0 observations deleted)
1999 2006

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         66      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         66      100.00
{txt}(0 observations deleted)
1999 2007

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         66      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         66      100.00
{txt}(0 observations deleted)
1999 2008

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         16       24.24       24.24
{txt}both in master and using data {c |}{res}         50       75.76      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         66      100.00
{txt}(0 observations deleted)
1999 2009

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         66      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         66      100.00
{txt}(0 observations deleted)
1999 2010

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         66      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         66      100.00
{txt}(0 observations deleted)

        idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          3 {c |}{res}         66      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}         66      100.00
{txt}(0 observations deleted)
(note: file temp2_xchain_1999.dta not found)
file temp2_xchain_1999.dta saved
(21 observations deleted)
(note: dataset contains 0 observations)
(note: file temp_exit_entry_2000.dta not found)
file temp_exit_entry_2000.dta saved
(0 observations deleted)
2000 2001

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         21      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         21      100.00
{txt}(0 observations deleted)
2000 2002

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         21      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         21      100.00
{txt}(0 observations deleted)
2000 2003

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         21      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         21      100.00
{txt}(0 observations deleted)
2000 2004

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         21      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         21      100.00
{txt}(0 observations deleted)
2000 2005

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         21      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         21      100.00
{txt}(0 observations deleted)
2000 2006

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         21      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         21      100.00
{txt}(0 observations deleted)
2000 2007

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         19       90.48       90.48
{txt}both in master and using data {c |}{res}          2        9.52      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         21      100.00
{txt}(0 observations deleted)
2000 2008

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}          2        9.52        9.52
{txt}both in master and using data {c |}{res}         19       90.48      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         21      100.00
{txt}(0 observations deleted)
2000 2009

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         21      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         21      100.00
{txt}(0 observations deleted)
2000 2010

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         21      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         21      100.00
{txt}(0 observations deleted)

        idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          3 {c |}{res}         21      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}         21      100.00
{txt}(0 observations deleted)
(note: file temp2_xchain_2000.dta not found)
file temp2_xchain_2000.dta saved
(132 observations deleted)
(note: dataset contains 0 observations)
(note: file temp_exit_entry_2001.dta not found)
file temp_exit_entry_2001.dta saved
(0 observations deleted)
2001 2002

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        131       98.50       98.50
{txt}both in master and using data {c |}{res}          2        1.50      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        133      100.00
{txt}(0 observations deleted)
2001 2003

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        133      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        133      100.00
{txt}(0 observations deleted)
2001 2004

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        131       98.50       98.50
{txt}both in master and using data {c |}{res}          2        1.50      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        133      100.00
{txt}(0 observations deleted)
2001 2005

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         78       58.21       58.21
{txt}both in master and using data {c |}{res}         56       41.79      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        134      100.00
{txt}(0 observations deleted)
2001 2006

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        134      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        134      100.00
{txt}(0 observations deleted)
2001 2007

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        131       96.32       96.32
{txt}both in master and using data {c |}{res}          5        3.68      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        136      100.00
{txt}(0 observations deleted)
2001 2008

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         64       36.78       36.78
{txt}both in master and using data {c |}{res}        110       63.22      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        174      100.00
{txt}(0 observations deleted)
2001 2009

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        174      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        174      100.00
{txt}(0 observations deleted)
2001 2010

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        174      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        174      100.00
{txt}(0 observations deleted)

        idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}          2        1.15        1.15
{txt}          3 {c |}{res}        172       98.85      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        174      100.00
{txt}(2 observations deleted)
(note: file temp2_xchain_2001.dta not found)
file temp2_xchain_2001.dta saved
(119 observations deleted)
(note: file temp_exit_entry_2002.dta not found)
file temp_exit_entry_2002.dta saved
(3 observations deleted)
2002 2003

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        114       95.80       95.80
{txt}both in master and using data {c |}{res}          5        4.20      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        119      100.00
{txt}(0 observations deleted)
2002 2004

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        116       95.08       95.08
{txt}both in master and using data {c |}{res}          6        4.92      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        122      100.00
{txt}(0 observations deleted)
2002 2005

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        122      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        122      100.00
{txt}(0 observations deleted)
2002 2006

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        122      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        122      100.00
{txt}(0 observations deleted)
2002 2007

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        118       96.72       96.72
{txt}both in master and using data {c |}{res}          4        3.28      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        122      100.00
{txt}(0 observations deleted)
2002 2008

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         15       11.54       11.54
{txt}both in master and using data {c |}{res}        115       88.46      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        130      100.00
{txt}(0 observations deleted)
2002 2009

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        130      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        130      100.00
{txt}(0 observations deleted)
2002 2010

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        130      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        130      100.00
{txt}(0 observations deleted)

        idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          3 {c |}{res}        130      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        130      100.00
{txt}(0 observations deleted)
(note: file temp2_xchain_2002.dta not found)
file temp2_xchain_2002.dta saved
(530 observations deleted)
(note: file temp_exit_entry_2003.dta not found)
file temp_exit_entry_2003.dta saved
(13 observations deleted)
2003 2004

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        507       93.89       93.89
{txt}both in master and using data {c |}{res}         33        6.11      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        540      100.00
{txt}(0 observations deleted)
2003 2005

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        519       96.11       96.11
{txt}both in master and using data {c |}{res}         21        3.89      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        540      100.00
{txt}(0 observations deleted)
2003 2006

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        540      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        540      100.00
{txt}(0 observations deleted)
2003 2007

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        530       96.19       96.19
{txt}both in master and using data {c |}{res}         21        3.81      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        551      100.00
{txt}(0 observations deleted)
2003 2008

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         62        8.74        8.74
{txt}both in master and using data {c |}{res}        647       91.26      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        709      100.00
{txt}(0 observations deleted)
2003 2009

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        709      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        709      100.00
{txt}(0 observations deleted)
2003 2010

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        709      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        709      100.00
{txt}(0 observations deleted)

        idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          3 {c |}{res}        709      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        709      100.00
{txt}(0 observations deleted)
(note: file temp2_xchain_2003.dta not found)
file temp2_xchain_2003.dta saved
(41 observations deleted)
(note: file temp_exit_entry_2004.dta not found)
file temp_exit_entry_2004.dta saved
(3 observations deleted)
2004 2005

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         37       82.22       82.22
{txt}both in master and using data {c |}{res}          8       17.78      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         45      100.00
{txt}(0 observations deleted)
2004 2006

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         39       86.67       86.67
{txt}both in master and using data {c |}{res}          6       13.33      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         45      100.00
{txt}(0 observations deleted)
2004 2007

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         40       88.89       88.89
{txt}both in master and using data {c |}{res}          5       11.11      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         45      100.00
{txt}(0 observations deleted)
2004 2008

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         14       30.43       30.43
{txt}both in master and using data {c |}{res}         32       69.57      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         46      100.00
{txt}(0 observations deleted)
2004 2009

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         46      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         46      100.00
{txt}(0 observations deleted)
2004 2010

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         46      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         46      100.00
{txt}(0 observations deleted)

        idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          3 {c |}{res}         46      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}         46      100.00
{txt}(0 observations deleted)
(note: file temp2_xchain_2004.dta not found)
file temp2_xchain_2004.dta saved
(247 observations deleted)
(note: file temp_exit_entry_2005.dta not found)
file temp_exit_entry_2005.dta saved
(66 observations deleted)
2005 2006

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        247      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        247      100.00
{txt}(0 observations deleted)
2005 2007

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        245       97.61       97.61
{txt}both in master and using data {c |}{res}          6        2.39      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        251      100.00
{txt}(0 observations deleted)
2005 2008

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}          6        1.94        1.94
{txt}both in master and using data {c |}{res}        304       98.06      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        310      100.00
{txt}(0 observations deleted)
2005 2009

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        310      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        310      100.00
{txt}(0 observations deleted)
2005 2010

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        310      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        310      100.00
{txt}(0 observations deleted)

        idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          3 {c |}{res}        310      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        310      100.00
{txt}(0 observations deleted)
(note: file temp2_xchain_2005.dta not found)
file temp2_xchain_2005.dta saved
(4 observations deleted)
(note: dataset contains 0 observations)
(note: file temp_exit_entry_2006.dta not found)
file temp_exit_entry_2006.dta saved
(0 observations deleted)
2006 2007

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}          2       50.00       50.00
{txt}both in master and using data {c |}{res}          2       50.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}          4      100.00
{txt}(0 observations deleted)
2006 2008

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}          2       50.00       50.00
{txt}both in master and using data {c |}{res}          2       50.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}          4      100.00
{txt}(0 observations deleted)
2006 2009

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}          4      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}          4      100.00
{txt}(0 observations deleted)
2006 2010

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}          4      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}          4      100.00
{txt}(0 observations deleted)

        idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          3 {c |}{res}          4      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}          4      100.00
{txt}(0 observations deleted)
(note: file temp2_xchain_2006.dta not found)
file temp2_xchain_2006.dta saved
(275 observations deleted)
(note: file temp_exit_entry_2007.dta not found)
file temp_exit_entry_2007.dta saved
(12 observations deleted)
2007 2008

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
both in master and using data {c |}{res}        290      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        290      100.00
{txt}(0 observations deleted)
2007 2009

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        290      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        290      100.00
{txt}(0 observations deleted)
2007 2010

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}        290      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        290      100.00
{txt}(0 observations deleted)

        idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          3 {c |}{res}        290      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        290      100.00
{txt}(0 observations deleted)
(note: file temp2_xchain_2007.dta not found)
file temp2_xchain_2007.dta saved
(4568 observations deleted)
(note: file temp_exit_entry_2008.dta not found)
file temp_exit_entry_2008.dta saved
(71 observations deleted)
2008 2009

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}      4,537       99.32       99.32
{txt}both in master and using data {c |}{res}         31        0.68      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}      4,568      100.00
{txt}(0 observations deleted)
2008 2010

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}      4,514       98.69       98.69
{txt}both in master and using data {c |}{res}         60        1.31      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}      4,574      100.00
{txt}(0 observations deleted)

        idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,483       98.01       98.01
{txt}          3 {c |}{res}         91        1.99      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,574      100.00
{txt}(4483 observations deleted)
(note: file temp2_xchain_2008.dta not found)
file temp2_xchain_2008.dta saved
(27 observations deleted)
(note: file temp_exit_entry_2009.dta not found)
file temp_exit_entry_2009.dta saved
(2 observations deleted)
2009 2010

                       _merge {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
          only in master data {c |}{res}         27      100.00      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         27      100.00
{txt}(0 observations deleted)

        idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}         27      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}         27      100.00
{txt}(27 observations deleted)
(note: dataset contains 0 observations)
(note: file temp2_xchain_2009.dta not found)
file temp2_xchain_2009.dta saved
(50 observations deleted)
(note: dataset contains 0 observations)
(note: file temp_exit_entry_2010.dta not found)
file temp_exit_entry_2010.dta saved
(0 observations deleted)

        idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}         50      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}         50      100.00
{txt}(50 observations deleted)
(note: dataset contains 0 observations)
(note: file temp2_xchain_2010.dta not found)
file temp2_xchain_2010.dta saved

{com}.         
.         *** Assign single setyear to all members of a family ***
.         * Put all the chained changes in one file and assign single setyr to all members of a family revealed by the chain.
.         * challenge here is to set a single setyr for all families revealed by the chain.
.         * Two cases for a family: growing or shrinking
.                 
.         * the iteration of min commands in the loop below takes care of both cases by searching for the setyr for
.         * a family that covers all of its members.
. 
. if `b1'!=1997 {c -(}
.         use temp2_xchain_`b1', clear
.                 foreach y of local pcyr1 {c -(}
{txt}  2{com}.                         append using temp2_xchain_`y'
{txt}  3{com}.                 {c )-}
{txt}new1998 was {res}byte{txt} now {res}long
{com}.         {c )-}
{txt}
{com}. 
. if `b1'==1997 {c -(}
.         use temp2_xchain_1998, clear
.                 foreach y of local pcyr1 {c -(}
{txt}  2{com}.                         append using temp2_xchain_`y'
{txt}  3{com}.                 {c )-}
.         {c )-}
{txt}
{com}.         
.         
.         drop new
{txt}
{com}.         keep obs new* setyr* effyr*
{txt}
{com}.         
.         capture duplicates drop
{txt}
{com}.         egen double setyr = rowmin(setyr*)
{txt}
{com}.         egen nchain = rownonmiss(new*)
{txt}
{com}.         
.         rename obs obsoletenum
{txt}
{com}.         order obs setyr
{txt}
{com}.         sort obs
{txt}
{com}.         save temp2_xchain, replace
{txt}(note: file temp2_xchain.dta not found)
file temp2_xchain.dta saved

{com}.                 /* This file groups all families that change over time */
. 
.         
.         use temp2_xchain, clear
{txt}
{com}.                 drop setyr effyr*
{txt}
{com}.                 egen t1 = seq(), by(obs)
{txt}
{com}.                 reshape long new setyr, i(obs t1) j(effyr)
{txt}(note: j = 1994 1995 1996 1998 1999 2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010)

Data{col 36}wide{col 43}->{col 48}long
{hline 77}
Number of obs.                 {res}    2061   {txt}->{res}   32976
{txt}Number of variables            {res}      35   {txt}->{res}       6
{txt}j variable (16 values)                    ->   {res}effyr
{txt}xij variables:
            {res}new1994 new1995 ... new2010   {txt}->   {res}new
      setyr1994 setyr1995 ... setyr2010   {txt}->   {res}setyr
{txt}{hline 77}

{com}.                 drop if new==. & setyr==.
{txt}(28794 observations deleted)

{com}.                 drop t1 nchain
{txt}
{com}.                 duplicates drop obs effyr new setyr, force

{p 0 4}{txt}Duplicates in terms of {res} obsoletenum effyr new setyr{p_end}

{txt}(466 observations deleted)

{com}.                 
.                 rename new newnum
{txt}
{com}.         
.         
.         *** Add simple changes back in (no chains) ***
.         * have to add these in before the min loop below in case a non-chain obs-pair is part of a family
.                 sort obsoletenum newnum effyr
{txt}
{com}.                 merge obsoletenum newnum effyr using PC_setyr_`b'_`e'
{txt}
{com}.                 
.                 drop if effyr < `b'| effyr > `e'
{txt}(0 observations deleted)

{com}.                 tab _merge

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      2,001       23.33       23.33
{txt}          2 {c |}{res}      4,861       56.67       80.00
{txt}          3 {c |}{res}      1,715       20.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      8,577      100.00
{txt}
{com}.                 drop _merge
{txt}
{com}. 
.         *** Family identifcation loop over time ***
.         * Example:
.         * 1999: three codes become two codes in 2000 and these two codes each map into two different 
.         * codes in 2001, some of which might already have existed in 1999.
.         * all these codes will be grouped together starting 1999 in this loop (they are assigned the minimum setyear).
.         
.         egen double t1 = min(setyr), by(obsoletenum)
{txt}
{com}.         rename setyr oldsetyr
{txt}
{com}.         local zzz = 2
{txt}
{com}.         local stop = 0
{txt}
{com}.         while `stop'==0 {c -(}
{txt}  2{com}.                 noisily display [`zzz']
{txt}  3{com}.                 local zlag = `zzz'-1
{txt}  4{com}.                 if mod(`zzz',2)==0 {c -(}
{txt}  5{com}.                         egen double t`zzz'= min(t`zlag'), by(newnum)
{txt}  6{com}.                 {c )-}
{txt}  7{com}.         
.                 if mod(`zzz',2)~=0 {c -(}
{txt}  8{com}.                         egen double t`zzz'= min(t`zlag'), by(obsoletenum)
{txt}  9{com}.                 {c )-}
{txt} 10{com}.         
.                 compare t`zzz' t`zlag'
{txt} 11{com}.                 gen idx = t`zzz'==t`zlag'
{txt} 12{com}.                 tab idx
{txt} 13{com}.                 local stop = r(r)==1
{txt} 14{com}.                 local zzz = `zzz'+1
{txt} 15{com}.                 display r(r) " " [`stop']
{txt} 16{com}.                 drop idx
{txt} 17{com}.                 {c )-}
2

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
t2<t1                   {res}     1559     -3575.001    -709.7869      -.0001
{txt}t2=t1                   {res}     7018
{txt}{col 24}{hline 10}
jointly defined         {res}     8577     -3575.001    -129.0145           0
{txt}{col 24}{hline 10}
total                   {res}     8577

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}      1,559       18.18       18.18
{txt}          1 {c |}{res}      7,018       81.82      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      8,577      100.00
2 0
3

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
t3<t2                   {res}      546     -380.0001    -15.01325      -.0001
{txt}t3=t2                   {res}     8031
{txt}{col 24}{hline 10}
jointly defined         {res}     8577     -380.0001    -.9557226           0
{txt}{col 24}{hline 10}
total                   {res}     8577

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        546        6.37        6.37
{txt}          1 {c |}{res}      8,031       93.63      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      8,577      100.00
2 0
4

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
t4<t3                   {res}      494     -303.0003    -11.84237      -.0001
{txt}t4=t3                   {res}     8083
{txt}{col 24}{hline 10}
jointly defined         {res}     8577     -303.0003    -.6820722           0
{txt}{col 24}{hline 10}
total                   {res}     8577

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        494        5.76        5.76
{txt}          1 {c |}{res}      8,083       94.24      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      8,577      100.00
2 0
5

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
t5<t4                   {res}      194      -71.9996    -6.845501      -.0001
{txt}t5=t4                   {res}     8383
{txt}{col 24}{hline 10}
jointly defined         {res}     8577      -71.9996    -.1548359           0
{txt}{col 24}{hline 10}
total                   {res}     8577

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        194        2.26        2.26
{txt}          1 {c |}{res}      8,383       97.74      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      8,577      100.00
2 0
6

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
t6<t5                   {res}      224      -29.0003     -3.19193      -.0001
{txt}t6=t5                   {res}     8353
{txt}{col 24}{hline 10}
jointly defined         {res}     8577      -29.0003    -.0833616           0
{txt}{col 24}{hline 10}
total                   {res}     8577

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        224        2.61        2.61
{txt}          1 {c |}{res}      8,353       97.39      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      8,577      100.00
2 0
7

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
t7<t6                   {res}       75       -9.9999    -2.120063      -.0001
{txt}t7=t6                   {res}     8502
{txt}{col 24}{hline 10}
jointly defined         {res}     8577       -9.9999    -.0185385           0
{txt}{col 24}{hline 10}
total                   {res}     8577

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}         75        0.87        0.87
{txt}          1 {c |}{res}      8,502       99.13      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      8,577      100.00
2 0
8

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
t8<t7                   {res}       44       -9.9999    -3.318223      -.0001
{txt}t8=t7                   {res}     8533
{txt}{col 24}{hline 10}
jointly defined         {res}     8577       -9.9999    -.0170225           0
{txt}{col 24}{hline 10}
total                   {res}     8577

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}         44        0.51        0.51
{txt}          1 {c |}{res}      8,533       99.49      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      8,577      100.00
2 0
9

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
t9<t8                   {res}       17       -9.9999    -7.529323      -.0001
{txt}t9=t8                   {res}     8560
{txt}{col 24}{hline 10}
jointly defined         {res}     8577       -9.9999    -.0149235           0
{txt}{col 24}{hline 10}
total                   {res}     8577

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}         17        0.20        0.20
{txt}          1 {c |}{res}      8,560       99.80      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      8,577      100.00
2 0
10

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
t10<t9                  {res}       11       -9.9999    -3.454445     -1.9999
{txt}t10=t9                  {res}     8566
{txt}{col 24}{hline 10}
jointly defined         {res}     8577       -9.9999    -.0044303           0
{txt}{col 24}{hline 10}
total                   {res}     8577

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}         11        0.13        0.13
{txt}          1 {c |}{res}      8,566       99.87      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      8,577      100.00
2 0
11

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
t11<t10                 {res}       12       -1.9999      -1.9999     -1.9999
{txt}t11=t10                 {res}     8565
{txt}{col 24}{hline 10}
jointly defined         {res}     8577       -1.9999     -.002798           0
{txt}{col 24}{hline 10}
total                   {res}     8577

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}         12        0.14        0.14
{txt}          1 {c |}{res}      8,565       99.86      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      8,577      100.00
2 0
12

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
t12<t11                 {res}        2       -1.9999      -1.9999     -1.9999
{txt}t12=t11                 {res}     8575
{txt}{col 24}{hline 10}
jointly defined         {res}     8577       -1.9999    -.0004663           0
{txt}{col 24}{hline 10}
total                   {res}     8577

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}          2        0.02        0.02
{txt}          1 {c |}{res}      8,575       99.98      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      8,577      100.00
2 0
13

{txt}{col 41}{hline 10} difference {hline 10}
{col 29}count{col 41}minimum{col 54}average{col 66}maximum
{hline 72}
t13=t12                 {res}     8577
{txt}{col 24}{hline 10}
jointly defined         {res}     8577             0            0           0
{txt}{col 24}{hline 10}
total                   {res}     8577

        {txt}idx {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      8,577      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      8,577      100.00
1 1
{txt}
{com}.         
.         
.         
.         local yyy = `zzz'-1
{txt}
{com}.         gen double setyr = t`yyy'
{txt}
{com}.         keep obsoletenum effyr newnum setyr
{txt}
{com}.         duplicates drop

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)

{com}.         sort obsoletenum newnum effyr
{txt}
{com}.         
.         
. 
. save  output_file_PC_`b'_`e'_setyr, replace
{txt}(note: file output_file_PC_1993_2010_setyr.dta not found)
file output_file_PC_1993_2010_setyr.dta saved

{com}. 
. 
. 
. *********************************************************       
. *** Step 4: Consistent panel over time (procedure PS) ***
. *********************************************************       
. *** Generate concordance file with ALL PC codes between `b' and `e' ***
.         * including codes that have not changed
.         * procedure draws again on Pierce and Schott (2012) but with some adaptations
.         * While they develop a concordance specific to the codes featuring in the data, 
.                 * we take all potential (mandatory) PC8 codes into account
.         * We develop a concordance for all existing PC8 codes (generic for all countries + necessary to match trade and production)
. 
. 
.         * generate files with PC codes in each particular year
.                 * based on PC list, Eurostat Ramon
.                 * however: we only keep "mandatory disaggregated" codes, i.e. no B-list, N-list, Q-list, T-list and Z-list codes
.                 * B-list and N-list codes can feature in the prodcom data, they will be recoded into their mandatory counterparts 
.                         * prior to concording
.                 
.         foreach x of numlist `b'/`e'{c -(}
{txt}  2{com}.         
.                 use PC_`x', clear
{txt}  3{com}.                 
.                 * merge with file with optional codes (some optional codes become mandatory in later years)
.                                 * but we need to keep the more aggregated (previous mandatory) code in all years
.                                 
.                                 rename pc pc8
{txt}  4{com}.                                 sort pc8
{txt}  5{com}.                                 count
{txt}  6{com}.                                 merge pc8 using optional_codes_`b'_`e'_sample
{txt}  7{com}.                                 tab _m
{txt}  8{com}.                                 replace pc8=pc_mand if _m==3
{txt}  9{com}.                                 drop if _m==2
{txt} 10{com}.                                 drop _m pc_mand
{txt} 11{com}.                                 rename pc8 pc
{txt} 12{com}.                                 duplicates drop
{txt} 13{com}.                 
.                 * All codes should be numeric (T, Z, E and Q headings do not feature in the file with "regular" codes)
.                         count
{txt} 14{com}.                         destring pc, gen(pcnum)
{txt} 15{com}.                         count if pc!="" & pcnum==.
{txt} 16{com}.                         keep pcnum pc
{txt} 17{com}.                         duplicates drop
{txt} 18{com}.                         count
{txt} 19{com}.                         save PC2_`x', replace
{txt} 20{com}.                 {c )-}
{res} 4802

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,799       81.13       81.13
{txt}          2 {c |}{res}      1,113       18.82       99.95
{txt}          3 {c |}{res}          3        0.05      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,915      100.00
{txt}(3 real changes made)
(1113 observations deleted)

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(1 observation deleted)
{res} 4801
{txt}pc has all characters numeric; pcnum {res}generated {txt}as {res}long
    0

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res} 4801
{txt}(note: file PC2_1993.dta not found)
file PC2_1993.dta saved
{res} 4830

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,801       81.14       81.14
{txt}          2 {c |}{res}      1,087       18.37       99.51
{txt}          3 {c |}{res}         29        0.49      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,917      100.00
{txt}(29 real changes made)
(1087 observations deleted)

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(16 observations deleted)
{res} 4814
{txt}pc has all characters numeric; pcnum {res}generated {txt}as {res}long
    0

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res} 4814
{txt}(note: file PC2_1994.dta not found)
file PC2_1994.dta saved
{res} 4840

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,809       81.16       81.16
{txt}          2 {c |}{res}      1,085       18.31       99.48
{txt}          3 {c |}{res}         31        0.52      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,925      100.00
{txt}(31 real changes made)
(1085 observations deleted)

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(17 observations deleted)
{res} 4823
{txt}pc has all characters numeric; pcnum {res}generated {txt}as {res}long
    0

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res} 4823
{txt}(note: file PC2_1995.dta not found)
file PC2_1995.dta saved
{res} 4807

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,770       81.04       81.04
{txt}          2 {c |}{res}      1,079       18.33       99.37
{txt}          3 {c |}{res}         37        0.63      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,886      100.00
{txt}(37 real changes made)
(1079 observations deleted)

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(21 observations deleted)
{res} 4786
{txt}pc has all characters numeric; pcnum {res}generated {txt}as {res}long
    0

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res} 4786
{txt}(note: file PC2_1996.dta not found)
file PC2_1996.dta saved
{res} 4807

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,770       81.04       81.04
{txt}          2 {c |}{res}      1,079       18.33       99.37
{txt}          3 {c |}{res}         37        0.63      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,886      100.00
{txt}(37 real changes made)
(1079 observations deleted)

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(21 observations deleted)
{res} 4786
{txt}pc has all characters numeric; pcnum {res}generated {txt}as {res}long
    0

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res} 4786
{txt}(note: file PC2_1997.dta not found)
file PC2_1997.dta saved
{res} 4809

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,768       81.03       81.03
{txt}          2 {c |}{res}      1,075       18.27       99.30
{txt}          3 {c |}{res}         41        0.70      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,884      100.00
{txt}(41 real changes made)
(1075 observations deleted)

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(23 observations deleted)
{res} 4786
{txt}pc has all characters numeric; pcnum {res}generated {txt}as {res}long
    0

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res} 4786
{txt}(note: file PC2_1998.dta not found)
file PC2_1998.dta saved
{res} 4839

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,791       81.11       81.11
{txt}          2 {c |}{res}      1,068       18.08       99.19
{txt}          3 {c |}{res}         48        0.81      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,907      100.00
{txt}(48 real changes made)
(1068 observations deleted)

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res} 4839
{txt}pc has all characters numeric; pcnum {res}generated {txt}as {res}long
    0

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(27 observations deleted)
{res} 4812
{txt}(note: file PC2_1999.dta not found)
file PC2_1999.dta saved
{res} 4832

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,788       81.10       81.10
{txt}          2 {c |}{res}      1,072       18.16       99.25
{txt}          3 {c |}{res}         44        0.75      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,904      100.00
{txt}(44 real changes made)
(1072 observations deleted)

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(24 observations deleted)
{res} 4808
{txt}pc has all characters numeric; pcnum {res}generated {txt}as {res}long
    0

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res} 4808
{txt}(note: file PC2_2000.dta not found)
file PC2_2000.dta saved
{res} 4793

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,750       80.98       80.98
{txt}          2 {c |}{res}      1,073       18.29       99.27
{txt}          3 {c |}{res}         43        0.73      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,866      100.00
{txt}(43 real changes made)
(1073 observations deleted)

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(23 observations deleted)
{res} 4770
{txt}pc has all characters numeric; pcnum {res}generated {txt}as {res}long
    0

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res} 4770
{txt}(note: file PC2_2001.dta not found)
file PC2_2001.dta saved
{res} 4764

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,721       80.88       80.88
{txt}          2 {c |}{res}      1,073       18.38       99.26
{txt}          3 {c |}{res}         43        0.74      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,837      100.00
{txt}(43 real changes made)
(1073 observations deleted)

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(23 observations deleted)
{res} 4741
{txt}pc has all characters numeric; pcnum {res}generated {txt}as {res}long
    0

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res} 4741
{txt}(note: file PC2_2002.dta not found)
file PC2_2002.dta saved
{res} 4693

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,657       80.67       80.67
{txt}          2 {c |}{res}      1,080       18.71       99.38
{txt}          3 {c |}{res}         36        0.62      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,773      100.00
{txt}(36 real changes made)
(1080 observations deleted)

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(19 observations deleted)
{res} 4674
{txt}pc has all characters numeric; pcnum {res}generated {txt}as {res}long
    0

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res} 4674
{txt}(note: file PC2_2003.dta not found)
file PC2_2003.dta saved
{res} 4683

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,647       80.64       80.64
{txt}          2 {c |}{res}      1,080       18.74       99.38
{txt}          3 {c |}{res}         36        0.62      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,763      100.00
{txt}(36 real changes made)
(1080 observations deleted)

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(19 observations deleted)
{res} 4664
{txt}pc has all characters numeric; pcnum {res}generated {txt}as {res}long
    0

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res} 4664
{txt}(note: file PC2_2004.dta not found)
file PC2_2004.dta saved
{res} 4489

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,449       79.95       79.95
{txt}          2 {c |}{res}      1,076       19.34       99.28
{txt}          3 {c |}{res}         40        0.72      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,565      100.00
{txt}(40 real changes made)
(1076 observations deleted)

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(22 observations deleted)
{res} 4467
{txt}pc has all characters numeric; pcnum {res}generated {txt}as {res}long
    0

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res} 4467
{txt}(note: file PC2_2005.dta not found)
file PC2_2005.dta saved
{res} 4487

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,447       79.94       79.94
{txt}          2 {c |}{res}      1,076       19.34       99.28
{txt}          3 {c |}{res}         40        0.72      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,563      100.00
{txt}(40 real changes made)
(1076 observations deleted)

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(22 observations deleted)
{res} 4465
{txt}pc has all characters numeric; pcnum {res}generated {txt}as {res}long
    0

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res} 4465
{txt}(note: file PC2_2006.dta not found)
file PC2_2006.dta saved
{res} 4418

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,378       79.69       79.69
{txt}          2 {c |}{res}      1,076       19.59       99.27
{txt}          3 {c |}{res}         40        0.73      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,494      100.00
{txt}(40 real changes made)
(1076 observations deleted)

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(22 observations deleted)
{res} 4396
{txt}pc has all characters numeric; pcnum {res}generated {txt}as {res}long
    0

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res} 4396
{txt}(note: file PC2_2007.dta not found)
file PC2_2007.dta saved
{res} 3864

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      3,864       77.59       77.59
{txt}          2 {c |}{res}      1,116       22.41      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,980      100.00
{txt}(0 real changes made)
(1116 observations deleted)

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res} 3864
{txt}pc has all characters numeric; pcnum {res}generated {txt}as {res}long
    0

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res} 3864
{txt}(note: file PC2_2008.dta not found)
file PC2_2008.dta saved
{res} 3851

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      3,851       77.53       77.53
{txt}          2 {c |}{res}      1,116       22.47      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,967      100.00
{txt}(0 real changes made)
(1116 observations deleted)

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res} 3851
{txt}pc has all characters numeric; pcnum {res}generated {txt}as {res}long
    0

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res} 3851
{txt}(note: file PC2_2009.dta not found)
file PC2_2009.dta saved
{res} 3832

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      3,832       77.45       77.45
{txt}          2 {c |}{res}      1,116       22.55      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,948      100.00
{txt}(0 real changes made)
(1116 observations deleted)

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res} 3832
{txt}pc has all characters numeric; pcnum {res}generated {txt}as {res}long
    0

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res} 3832
{txt}(note: file PC2_2010.dta not found)
file PC2_2010.dta saved

{com}.                 
.                 
.         foreach y of numlist `b' / `e' {c -(}
{txt}  2{com}. 
.                 local ylead = `y'+1
{txt}  3{com}.                 noisily display " "
{txt}  4{com}.                 noisily display " "
{txt}  5{com}.                 noisily display "NEW LOOP " [`y']
{txt}  6{com}.                 noisily display " "
{txt}  7{com}.                 noisily display " "
{txt}  8{com}. 
.         * Step 1
.         * get obsolete-new files ready
.         * temp_obsolete is used to assign setyrs to codes that are last used in year y
.         * To insure against the code ever becomming obsolete, 
.         * i.e., it being an obsolete code in any year after the year of the loop
. 
.         use output_file_PC_`b'_`e'_setyr, clear
{txt}  9{com}.                 keep if effyr>=`ylead'
{txt} 10{com}.                 keep obsoletenum setyr
{txt} 11{com}.                 drop if obsoletenum==.
{txt} 12{com}.                 capture duplicates drop
{txt} 13{com}.                 sort obsoletenum
{txt} 14{com}.         save temp_obsolete_`y', replace emptyok
{txt} 15{com}. 
.         * Step 2
.         * temp_new is used to assign setyrs to codes that are new in year y
.         * bascially want to insure against this code ever having been a new code prior to this
.         * year; if so, need to assign it a setyr
.         
.         use output_file_PC_`b'_`e'_setyr, clear
{txt} 16{com}.                 keep if effyr<=`ylead'
{txt} 17{com}.                 keep newnum setyr
{txt} 18{com}.                 drop if newnum==.
{txt} 19{com}.                 capture duplicates drop
{txt} 20{com}.                 sort newnum
{txt} 21{com}.         save temp_new_`y', replace emptyok
{txt} 22{com}. 
.         * Step 3
.         * read in data and collapse to appropriate level
.         
.         use PC2_`y', clear
{txt} 23{com}.         
.         format pcnum %15.0f
{txt} 24{com}. 
.         * merge in obsolete-code family identifiers
.                 rename pcnum obsoletenum
{txt} 25{com}.                 sort obsoletenum
{txt} 26{com}.                 merge obsoletenum using temp_obsolete_`y', keep(setyr)
{txt} 27{com}.                 noisily tab _merge
{txt} 28{com}.                 drop if _merge==2
{txt} 29{com}.                 drop _merge
{txt} 30{com}.                 rename obsoletenum pcnum
{txt} 31{com}. 
.         * merge in new-code family identifiers
.                 rename pcnum newnum
{txt} 32{com}.                 sort newnum
{txt} 33{com}.                 merge newnum using temp_new_`y', keep(setyr) update
{txt} 34{com}.                 noisily tab _merge
{txt} 35{com}.                 drop if _merge==2
{txt} 36{com}.                 drop _merge
{txt} 37{com}.                 rename newnum pcnum
{txt} 38{com}. 
.         save prodcom_PC_`y'_concorded, replace
{txt} 39{com}. 
.         {c )-}
 
 
NEW LOOP 1993
 
 
{txt}(0 observations deleted)
(154 observations deleted)
(note: file temp_obsolete_1993.dta not found)
file temp_obsolete_1993.dta saved
(8527 observations deleted)
(4 observations deleted)
(note: file temp_new_1993.dta not found)
file temp_new_1993.dta saved

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}         25        0.43        0.43
{txt}          2 {c |}{res}        980       16.95       17.38
{txt}          3 {c |}{res}      4,776       82.62      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,781      100.00
{txt}(980 observations deleted)

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,800       99.05       99.05
{txt}          2 {c |}{res}         45        0.93       99.98
{txt}          3 {c |}{res}          1        0.02      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,846      100.00
{txt}(45 observations deleted)
(note: file prodcom_PC_1993_concorded.dta not found)
file prodcom_PC_1993_concorded.dta saved
 
 
NEW LOOP 1994
 
 
(50 observations deleted)
(151 observations deleted)
(note: file temp_obsolete_1994.dta not found)
file temp_obsolete_1994.dta saved
(8456 observations deleted)
(23 observations deleted)
(note: file temp_new_1994.dta not found)
file temp_new_1994.dta saved

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}         22        0.38        0.38
{txt}          2 {c |}{res}        962       16.66       17.04
{txt}          3 {c |}{res}      4,792       82.96      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,776      100.00
{txt}(962 observations deleted)

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,768       97.99       97.99
{txt}          2 {c |}{res}         52        1.07       99.05
{txt}          3 {c |}{res}         45        0.92       99.98
{txt}          5 {c |}{res}          1        0.02      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,866      100.00
{txt}(52 observations deleted)
(note: file prodcom_PC_1994_concorded.dta not found)
file prodcom_PC_1994_concorded.dta saved
 
 
NEW LOOP 1995
 
 
(121 observations deleted)
(122 observations deleted)
(note: file temp_obsolete_1995.dta not found)
file temp_obsolete_1995.dta saved
(8308 observations deleted)
(37 observations deleted)
(note: file temp_new_1995.dta not found)
file temp_new_1995.dta saved

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          2 {c |}{res}        931       16.18       16.18
{txt}          3 {c |}{res}      4,823       83.82      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,754      100.00
{txt}(931 observations deleted)

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,699       96.37       96.37
{txt}          2 {c |}{res}         53        1.09       97.46
{txt}          3 {c |}{res}         97        1.99       99.45
{txt}          5 {c |}{res}         27        0.55      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,876      100.00
{txt}(53 observations deleted)
(note: file prodcom_PC_1995_concorded.dta not found)
file prodcom_PC_1995_concorded.dta saved
 
 
NEW LOOP 1996
 
 
(269 observations deleted)
(107 observations deleted)
(note: file temp_obsolete_1996.dta not found)
file temp_obsolete_1996.dta saved
(8308 observations deleted)
(37 observations deleted)
(note: file temp_new_1996.dta not found)
file temp_new_1996.dta saved

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          2 {c |}{res}        956       16.65       16.65
{txt}          3 {c |}{res}      4,786       83.35      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,742      100.00
{txt}(956 observations deleted)

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,612       96.30       96.30
{txt}          2 {c |}{res}          3        0.06       96.37
{txt}          3 {c |}{res}        143        2.99       99.35
{txt}          5 {c |}{res}         31        0.65      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,789      100.00
{txt}(3 observations deleted)
(note: file prodcom_PC_1996_concorded.dta not found)
file prodcom_PC_1996_concorded.dta saved
 
 
NEW LOOP 1997
 
 
(269 observations deleted)
(107 observations deleted)
(note: file temp_obsolete_1997.dta not found)
file temp_obsolete_1997.dta saved
(8306 observations deleted)
(39 observations deleted)
(note: file temp_new_1997.dta not found)
file temp_new_1997.dta saved

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          2 {c |}{res}        956       16.65       16.65
{txt}          3 {c |}{res}      4,786       83.35      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,742      100.00
{txt}(956 observations deleted)

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,612       96.30       96.30
{txt}          2 {c |}{res}          3        0.06       96.37
{txt}          3 {c |}{res}        143        2.99       99.35
{txt}          5 {c |}{res}         31        0.65      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,789      100.00
{txt}(3 observations deleted)
(note: file prodcom_PC_1997_concorded.dta not found)
file prodcom_PC_1997_concorded.dta saved
 
 
NEW LOOP 1998
 
 
(271 observations deleted)
(107 observations deleted)
(note: file temp_obsolete_1998.dta not found)
file temp_obsolete_1998.dta saved
(8171 observations deleted)
(42 observations deleted)
(note: file temp_new_1998.dta not found)
file temp_new_1998.dta saved

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          2 {c |}{res}        956       16.65       16.65
{txt}          3 {c |}{res}      4,786       83.35      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,742      100.00
{txt}(956 observations deleted)

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,611       94.53       94.53
{txt}          2 {c |}{res}         92        1.89       96.41
{txt}          3 {c |}{res}        144        2.95       99.36
{txt}          5 {c |}{res}         31        0.64      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,878      100.00
{txt}(92 observations deleted)
(note: file prodcom_PC_1998_concorded.dta not found)
file prodcom_PC_1998_concorded.dta saved
 
 
NEW LOOP 1999
 
 
(406 observations deleted)
(47 observations deleted)
(note: file temp_obsolete_1999.dta not found)
file temp_obsolete_1999.dta saved
(8152 observations deleted)
(42 observations deleted)
(note: file temp_new_1999.dta not found)
file temp_new_1999.dta saved

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          2 {c |}{res}        925       16.12       16.12
{txt}          3 {c |}{res}      4,812       83.88      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,737      100.00
{txt}(925 observations deleted)

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,551       94.24       94.24
{txt}          2 {c |}{res}         17        0.35       94.60
{txt}          3 {c |}{res}        230        4.76       99.36
{txt}          5 {c |}{res}         31        0.64      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,829      100.00
{txt}(17 observations deleted)
(note: file prodcom_PC_1999_concorded.dta not found)
file prodcom_PC_1999_concorded.dta saved
 
 
NEW LOOP 2000
 
 
(425 observations deleted)
(47 observations deleted)
(note: file temp_obsolete_2000.dta not found)
file temp_obsolete_2000.dta saved
(8018 observations deleted)
(42 observations deleted)
(note: file temp_new_2000.dta not found)
file temp_new_2000.dta saved

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          2 {c |}{res}        929       16.19       16.19
{txt}          3 {c |}{res}      4,808       83.81      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,737      100.00
{txt}(929 observations deleted)

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,535       92.76       92.76
{txt}          2 {c |}{res}         81        1.66       94.42
{txt}          3 {c |}{res}        242        4.95       99.37
{txt}          5 {c |}{res}         31        0.63      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,889      100.00
{txt}(81 observations deleted)
(note: file prodcom_PC_2000_concorded.dta not found)
file prodcom_PC_2000_concorded.dta saved
 
 
NEW LOOP 2001
 
 
(559 observations deleted)
(47 observations deleted)
(note: file temp_obsolete_2001.dta not found)
file temp_obsolete_2001.dta saved
(7881 observations deleted)
(42 observations deleted)
(note: file temp_new_2001.dta not found)
file temp_new_2001.dta saved

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          2 {c |}{res}        966       16.84       16.84
{txt}          3 {c |}{res}      4,770       83.16      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,736      100.00
{txt}(966 observations deleted)

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,425       91.58       91.58
{txt}          2 {c |}{res}         62        1.28       92.86
{txt}          3 {c |}{res}        314        6.50       99.36
{txt}          5 {c |}{res}         31        0.64      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,832      100.00
{txt}(62 observations deleted)
(note: file prodcom_PC_2001_concorded.dta not found)
file prodcom_PC_2001_concorded.dta saved
 
 
NEW LOOP 2002
 
 
(696 observations deleted)
(44 observations deleted)
(note: file temp_obsolete_2002.dta not found)
file temp_obsolete_2002.dta saved
(7315 observations deleted)
(43 observations deleted)
(note: file temp_new_2002.dta not found)
file temp_new_2002.dta saved

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          2 {c |}{res}        989       17.26       17.26
{txt}          3 {c |}{res}      4,741       82.74      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,730      100.00
{txt}(989 observations deleted)

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,351       86.12       86.12
{txt}          2 {c |}{res}        311        6.16       92.28
{txt}          3 {c |}{res}        358        7.09       99.37
{txt}          5 {c |}{res}         32        0.63      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,052      100.00
{txt}(311 observations deleted)
(note: file prodcom_PC_2002_concorded.dta not found)
file prodcom_PC_2002_concorded.dta saved
 
 
NEW LOOP 2003
 
 
(1262 observations deleted)
(32 observations deleted)
(note: file temp_obsolete_2003.dta not found)
file temp_obsolete_2003.dta saved
(7227 observations deleted)
(44 observations deleted)
(note: file temp_new_2003.dta not found)
file temp_new_2003.dta saved

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          2 {c |}{res}      1,034       18.11       18.11
{txt}          3 {c |}{res}      4,674       81.89      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,708      100.00
{txt}(1034 observations deleted)

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,026       84.74       84.74
{txt}          2 {c |}{res}         77        1.62       86.36
{txt}          3 {c |}{res}        625       13.16       99.52
{txt}          5 {c |}{res}         23        0.48      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,751      100.00
{txt}(77 observations deleted)
(note: file prodcom_PC_2003_concorded.dta not found)
file prodcom_PC_2003_concorded.dta saved
 
 
NEW LOOP 2004
 
 
(1350 observations deleted)
(30 observations deleted)
(note: file temp_obsolete_2004.dta not found)
file temp_obsolete_2004.dta saved
(6828 observations deleted)
(122 observations deleted)
(note: file temp_new_2004.dta not found)
file temp_new_2004.dta saved

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          2 {c |}{res}      1,034       18.15       18.15
{txt}          3 {c |}{res}      4,664       81.85      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,698      100.00
{txt}(1034 observations deleted)

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,004       82.90       82.90
{txt}          2 {c |}{res}        166        3.44       86.34
{txt}          3 {c |}{res}        636       13.17       99.50
{txt}          5 {c |}{res}         24        0.50      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,830      100.00
{txt}(166 observations deleted)
(note: file prodcom_PC_2004_concorded.dta not found)
file prodcom_PC_2004_concorded.dta saved
 
 
NEW LOOP 2005
 
 
(1749 observations deleted)
(29 observations deleted)
(note: file temp_obsolete_2005.dta not found)
file temp_obsolete_2005.dta saved
(6819 observations deleted)
(122 observations deleted)
(note: file temp_new_2005.dta not found)
file temp_new_2005.dta saved

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          2 {c |}{res}      1,095       19.69       19.69
{txt}          3 {c |}{res}      4,467       80.31      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,562      100.00
{txt}(1095 observations deleted)

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      3,808       82.16       82.16
{txt}          2 {c |}{res}        168        3.62       85.78
{txt}          3 {c |}{res}        639       13.79       99.57
{txt}          5 {c |}{res}         20        0.43      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,635      100.00
{txt}(168 observations deleted)
(note: file prodcom_PC_2005_concorded.dta not found)
file prodcom_PC_2005_concorded.dta saved
 
 
NEW LOOP 2006
 
 
(1758 observations deleted)
(29 observations deleted)
(note: file temp_obsolete_2006.dta not found)
file temp_obsolete_2006.dta saved
(6472 observations deleted)
(125 observations deleted)
(note: file temp_new_2006.dta not found)
file temp_new_2006.dta saved

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          2 {c |}{res}      1,097       19.72       19.72
{txt}          3 {c |}{res}      4,465       80.28      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,562      100.00
{txt}(1097 observations deleted)

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      3,797       79.95       79.95
{txt}          2 {c |}{res}        284        5.98       85.93
{txt}          3 {c |}{res}        648       13.64       99.58
{txt}          5 {c |}{res}         20        0.42      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,749      100.00
{txt}(284 observations deleted)
(note: file prodcom_PC_2006_concorded.dta not found)
file prodcom_PC_2006_concorded.dta saved
 
 
NEW LOOP 2007
 
 
(2105 observations deleted)
(20 observations deleted)
(note: file temp_obsolete_2007.dta not found)
file temp_obsolete_2007.dta saved
(169 observations deleted)
(197 observations deleted)
(note: file temp_new_2007.dta not found)
file temp_new_2007.dta saved

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          2 {c |}{res}      1,134       20.51       20.51
{txt}          3 {c |}{res}      4,396       79.49      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,530      100.00
{txt}(1134 observations deleted)

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      3,584       42.68       42.68
{txt}          2 {c |}{res}      4,002       47.65       90.33
{txt}          3 {c |}{res}        732        8.72       99.05
{txt}          5 {c |}{res}         80        0.95      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      8,398      100.00
{txt}(4002 observations deleted)
(note: file prodcom_PC_2007_concorded.dta not found)
file prodcom_PC_2007_concorded.dta saved
 
 
NEW LOOP 2008
 
 
(8408 observations deleted)
(1 observation deleted)
(note: file temp_obsolete_2008.dta not found)
file temp_obsolete_2008.dta saved
(110 observations deleted)
(199 observations deleted)
(note: file temp_new_2008.dta not found)
file temp_new_2008.dta saved

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      3,791       96.07       96.07
{txt}          2 {c |}{res}         82        2.08       98.15
{txt}          3 {c |}{res}         73        1.85      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      3,946      100.00
{txt}(82 observations deleted)

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          2 {c |}{res}        965       19.98       19.98
{txt}          3 {c |}{res}         73        1.51       21.50
{txt}          4 {c |}{res}      3,791       78.50      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,829      100.00
{txt}(965 observations deleted)
(note: file prodcom_PC_2008_concorded.dta not found)
file prodcom_PC_2008_concorded.dta saved
 
 
NEW LOOP 2009
 
 
(8467 observations deleted)
(0 observations deleted)
(note: file temp_obsolete_2009.dta not found)
file temp_obsolete_2009.dta saved
(0 observations deleted)
(199 observations deleted)
(note: file temp_new_2009.dta not found)
file temp_new_2009.dta saved

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      3,806       97.51       97.51
{txt}          2 {c |}{res}         52        1.33       98.85
{txt}          3 {c |}{res}         45        1.15      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      3,903      100.00
{txt}(52 observations deleted)

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          2 {c |}{res}      1,004       20.68       20.68
{txt}          3 {c |}{res}         45        0.93       21.61
{txt}          4 {c |}{res}      3,806       78.39      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,855      100.00
{txt}(1004 observations deleted)
(note: file prodcom_PC_2009_concorded.dta not found)
file prodcom_PC_2009_concorded.dta saved
 
 
NEW LOOP 2010
 
 
(8577 observations deleted)
(0 observations deleted)
(note: dataset contains 0 observations)
(note: file temp_obsolete_2010.dta not found)
file temp_obsolete_2010.dta saved
(0 observations deleted)
(199 observations deleted)
(note: file temp_new_2010.dta not found)
file temp_new_2010.dta saved

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      3,832      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      3,832      100.00
{txt}(0 observations deleted)

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          2 {c |}{res}      1,023       21.07       21.07
{txt}          4 {c |}{res}      3,832       78.93      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,855      100.00
{txt}(1023 observations deleted)
(note: file prodcom_PC_2010_concorded.dta not found)
file prodcom_PC_2010_concorded.dta saved

{com}. 
.         * Step 4: Create panel file
.         foreach y of numlist `b' / `e' {c -(}
{txt}  2{com}.                 use prodcom_PC_`y'_concorded, replace
{txt}  3{com}.                 rename pcnum group`y'
{txt}  4{com}.                 drop if setyr==.
{txt}  5{com}.                 sort setyr group`y'
{txt}  6{com}.                 save junk_x_`y', replace
{txt}  7{com}.                 {c )-}
{txt}(25 observations deleted)
(note: file junk_x_1993.dta not found)
file junk_x_1993.dta saved
(22 observations deleted)
(note: file junk_x_1994.dta not found)
file junk_x_1994.dta saved
(0 observations deleted)
(note: file junk_x_1995.dta not found)
file junk_x_1995.dta saved
(0 observations deleted)
(note: file junk_x_1996.dta not found)
file junk_x_1996.dta saved
(0 observations deleted)
(note: file junk_x_1997.dta not found)
file junk_x_1997.dta saved
(0 observations deleted)
(note: file junk_x_1998.dta not found)
file junk_x_1998.dta saved
(0 observations deleted)
(note: file junk_x_1999.dta not found)
file junk_x_1999.dta saved
(0 observations deleted)
(note: file junk_x_2000.dta not found)
file junk_x_2000.dta saved
(0 observations deleted)
(note: file junk_x_2001.dta not found)
file junk_x_2001.dta saved
(0 observations deleted)
(note: file junk_x_2002.dta not found)
file junk_x_2002.dta saved
(0 observations deleted)
(note: file junk_x_2003.dta not found)
file junk_x_2003.dta saved
(0 observations deleted)
(note: file junk_x_2004.dta not found)
file junk_x_2004.dta saved
(0 observations deleted)
(note: file junk_x_2005.dta not found)
file junk_x_2005.dta saved
(0 observations deleted)
(note: file junk_x_2006.dta not found)
file junk_x_2006.dta saved
(0 observations deleted)
(note: file junk_x_2007.dta not found)
file junk_x_2007.dta saved
(0 observations deleted)
(note: file junk_x_2008.dta not found)
file junk_x_2008.dta saved
(0 observations deleted)
(note: file junk_x_2009.dta not found)
file junk_x_2009.dta saved
(0 observations deleted)
(note: file junk_x_2010.dta not found)
file junk_x_2010.dta saved

{com}. 
.         use junk_x_`b', replace
{txt}
{com}.         foreach y of numlist `b' / `e' {c -(}
{txt}  2{com}.                 display [`y']
{txt}  3{com}.                 merge setyr using junk_x_`y'
{txt}  4{com}.                 tab _merge
{txt}  5{com}.                 drop _merge
{txt}  6{com}.                 order setyr
{txt}  7{com}.                 sort setyr group`y'
{txt}  8{com}.                 {c )-}
1993
{txt}{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
the master data
{p_end}
{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
junk_x_1993.dta
{p_end}

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          3 {c |}{res}      4,776      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,776      100.00
1994
{txt}{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
the master data
{p_end}
{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
junk_x_1994.dta
{p_end}

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          2 {c |}{res}          1        0.02        0.02
{txt}          3 {c |}{res}      4,791       99.98      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,792      100.00
1995
{txt}{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
the master data
{p_end}
{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
junk_x_1995.dta
{p_end}

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          2 {c |}{res}         26        0.54        0.54
{txt}          3 {c |}{res}      4,797       99.46      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,823      100.00
1996
{txt}{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
the master data
{p_end}
{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
junk_x_1996.dta
{p_end}

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          2 {c |}{res}          4        0.08        0.08
{txt}          3 {c |}{res}      4,826       99.92      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,830      100.00
1997
{txt}{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
the master data
{p_end}
{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
junk_x_1997.dta
{p_end}

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          3 {c |}{res}      4,830      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,830      100.00
1998
{txt}{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
the master data
{p_end}
{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
junk_x_1998.dta
{p_end}

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          3 {c |}{res}      4,830      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,830      100.00
1999
{txt}{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
the master data
{p_end}
{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
junk_x_1999.dta
{p_end}

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          3 {c |}{res}      4,887      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,887      100.00
2000
{txt}{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
the master data
{p_end}
{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
junk_x_2000.dta
{p_end}

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          3 {c |}{res}      4,888      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,888      100.00
2001
{txt}{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
the master data
{p_end}
{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
junk_x_2001.dta
{p_end}

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          3 {c |}{res}      4,901      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,901      100.00
2002
{txt}{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
the master data
{p_end}
{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
junk_x_2002.dta
{p_end}

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          2 {c |}{res}          1        0.02        0.02
{txt}          3 {c |}{res}      4,904       99.98      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,905      100.00
2003
{txt}{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
the master data
{p_end}
{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
junk_x_2003.dta
{p_end}

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          2 {c |}{res}          1        0.02        0.02
{txt}          3 {c |}{res}      4,930       99.98      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,931      100.00
2004
{txt}{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
the master data
{p_end}
{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
junk_x_2004.dta
{p_end}

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          2 {c |}{res}          2        0.04        0.04
{txt}          3 {c |}{res}      4,932       99.96      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,934      100.00
2005
{txt}{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
the master data
{p_end}
{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
junk_x_2005.dta
{p_end}

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          2 {c |}{res}          1        0.02        0.02
{txt}          3 {c |}{res}      4,938       99.98      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,939      100.00
2006
{txt}{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
the master data
{p_end}
{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
junk_x_2006.dta
{p_end}

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          3 {c |}{res}      4,939      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,939      100.00
2007
{txt}{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
the master data
{p_end}
{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
junk_x_2007.dta
{p_end}

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          2 {c |}{res}          7        0.14        0.14
{txt}          3 {c |}{res}      4,943       99.86      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,950      100.00
2008
{txt}{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
the master data
{p_end}
{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
junk_x_2008.dta
{p_end}

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          3 {c |}{res}      5,007      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,007      100.00
2009
{txt}{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
the master data
{p_end}
{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
junk_x_2009.dta
{p_end}

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          3 {c |}{res}      5,007      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,007      100.00
2010
{txt}{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
the master data
{p_end}
{p 0 4}
variable{txt} setyr
does not uniquely identify observations in
junk_x_2010.dta
{p_end}

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          3 {c |}{res}      5,008      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,008      100.00
{txt}
{com}. 
. 
.         foreach y of numlist `b' / `e' {c -(}
{txt}  2{com}.                 egen i`y'= tag(setyr group`y')
{txt}  3{com}.                 replace group`y'=. if i`y'==0
{txt}  4{com}.                 drop i`y'
{txt}  5{com}.                 {c )-}
{txt}(187 real changes made, 187 to missing)
(172 real changes made, 172 to missing)
(168 real changes made, 168 to missing)
(209 real changes made, 209 to missing)
(209 real changes made, 209 to missing)
(209 real changes made, 209 to missing)
(183 real changes made, 183 to missing)
(187 real changes made, 187 to missing)
(225 real changes made, 225 to missing)
(255 real changes made, 255 to missing)
(323 real changes made, 323 to missing)
(335 real changes made, 335 to missing)
(533 real changes made, 533 to missing)
(535 real changes made, 535 to missing)
(612 real changes made, 612 to missing)
(1144 real changes made, 1144 to missing)
(1157 real changes made, 1157 to missing)
(1176 real changes made, 1176 to missing)

{com}. 
.         save setyr_PC_`b'_`e', replace
{txt}(note: file setyr_PC_1993_2010.dta not found)
file setyr_PC_1993_2010.dta saved

{com}.         
.         
. 
. ******************************************************  
. *** Step 5: Adjustments for changes in coverage PC ***
. ******************************************************
. * Coverage of PC list has changed over time
. * Codes that enter or exit from the list: temp_exit_entry_`y'
. 
. * generate one file with all exiting and entering codes 
. * since they are not covered in all years
. * taking into account that some entry/exit codes may be part of group of PC8 codes
. 
.         foreach y of local pcyr {c -(}
{txt}  2{com}.                 use temp_exit_entry_`y'
{txt}  3{com}.                         drop group
{txt}  4{com}.                         rename new`y' group
{txt}  5{com}.                         replace group=. if entry!=1
{txt}  6{com}.                         replace group = obs`y' if exit==1
{txt}  7{com}.                         keep group
{txt}  8{com}.                         gen exit=1
{txt}  9{com}.                         format group %15.0f
{txt} 10{com}.                         format exit %15.0f
{txt} 11{com}.                         rename group group`y'
{txt} 12{com}.                         sort group`y'
{txt} 13{com}.                 save temp_exit_`y', replace
{txt} 14{com}.                 {c )-}
{txt}(0 real changes made)
(4 real changes made)
(note: file temp_exit_1994.dta not found)
file temp_exit_1994.dta saved
(0 real changes made)
(19 real changes made)
(note: file temp_exit_1995.dta not found)
file temp_exit_1995.dta saved
(0 real changes made)
(14 real changes made)
(note: file temp_exit_1996.dta not found)
file temp_exit_1996.dta saved
(0 real changes made)
group was {res}byte{txt} now {res}long
{txt}(2 real changes made)
(note: file temp_exit_1998.dta not found)
file temp_exit_1998.dta saved
(0 real changes made)
(3 real changes made)
(note: file temp_exit_1999.dta not found)
file temp_exit_1999.dta saved
(0 real changes made)
(0 real changes made)
(note: dataset contains 0 observations)
(note: file temp_exit_2000.dta not found)
file temp_exit_2000.dta saved
(0 real changes made)
(0 real changes made)
(note: dataset contains 0 observations)
(note: file temp_exit_2001.dta not found)
file temp_exit_2001.dta saved
(0 real changes made)
(0 real changes made)
(note: file temp_exit_2002.dta not found)
file temp_exit_2002.dta saved
(0 real changes made)
(1 real change made)
(note: file temp_exit_2003.dta not found)
file temp_exit_2003.dta saved
(0 real changes made)
(1 real change made)
(note: file temp_exit_2004.dta not found)
file temp_exit_2004.dta saved
(0 real changes made)
(65 real changes made)
(note: file temp_exit_2005.dta not found)
file temp_exit_2005.dta saved
(0 real changes made)
(0 real changes made)
(note: dataset contains 0 observations)
(note: file temp_exit_2006.dta not found)
file temp_exit_2006.dta saved
(0 real changes made)
(3 real changes made)
(note: file temp_exit_2007.dta not found)
file temp_exit_2007.dta saved
(0 real changes made)
(52 real changes made)
(note: file temp_exit_2008.dta not found)
file temp_exit_2008.dta saved
(0 real changes made)
(1 real change made)
(note: file temp_exit_2009.dta not found)
file temp_exit_2009.dta saved
(0 real changes made)
(0 real changes made)
(note: dataset contains 0 observations)
(note: file temp_exit_2010.dta not found)
file temp_exit_2010.dta saved

{com}. 
.         use setyr_PC_`b'_`e', clear
{txt}
{com}.                 save temp, replace
{txt}file temp.dta saved

{com}.                 
.                 foreach y of local pcyr {c -(}
{txt}  2{com}.                         sort group`y'
{txt}  3{com}.                         merge group`y' using temp_exit_`y', update
{txt}  4{com}.                         tab _m
{txt}  5{com}.                         drop if _m==2
{txt}  6{com}.                         drop _m
{txt}  7{com}.                         {c )-}
{txt}{p 0 4}
variable{txt} group1994
does not uniquely identify observations in
the master data
{p_end}

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      5,003       99.86       99.86
{txt}          2 {c |}{res}          2        0.04       99.90
{txt}          3 {c |}{res}          5        0.10      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,010      100.00
{txt}(2 observations deleted)
{p 0 4}
variable{txt} group1995
does not uniquely identify observations in
the master data
{p_end}

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,967       99.04       99.04
{txt}          2 {c |}{res}          7        0.14       99.18
{txt}          4 {c |}{res}         41        0.82      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,015      100.00
{txt}(7 observations deleted)
{p 0 4}
variable{txt} group1996
does not uniquely identify observations in
the master data
{p_end}

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,991       99.42       99.42
{txt}          2 {c |}{res}         12        0.24       99.66
{txt}          3 {c |}{res}          1        0.02       99.68
{txt}          4 {c |}{res}         16        0.32      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,020      100.00
{txt}(12 observations deleted)
{p 0 4}
variable{txt} group1998
does not uniquely identify observations in
the master data
{p_end}

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      5,006       99.96       99.96
{txt}          4 {c |}{res}          2        0.04      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,008      100.00
{txt}(0 observations deleted)
{p 0 4}
variable{txt} group1999
does not uniquely identify observations in
the master data
{p_end}

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,945       98.74       98.74
{txt}          3 {c |}{res}         17        0.34       99.08
{txt}          4 {c |}{res}         46        0.92      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,008      100.00
{txt}(0 observations deleted)
{p 0 4}
variable{txt} group2000
does not uniquely identify observations in
the master data
{p_end}

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      5,008      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,008      100.00
{txt}(0 observations deleted)
{p 0 4}
variable{txt} group2001
does not uniquely identify observations in
the master data
{p_end}

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      5,008      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,008      100.00
{txt}(0 observations deleted)
{p 0 4}
variable{txt} group2002
does not uniquely identify observations in
the master data
{p_end}

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      5,005       99.94       99.94
{txt}          3 {c |}{res}          1        0.02       99.96
{txt}          4 {c |}{res}          2        0.04      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,008      100.00
{txt}(0 observations deleted)
{p 0 4}
variable{txt} group2003
does not uniquely identify observations in
the master data
{p_end}

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,996       99.74       99.74
{txt}          2 {c |}{res}          1        0.02       99.76
{txt}          3 {c |}{res}          1        0.02       99.78
{txt}          4 {c |}{res}         11        0.22      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,009      100.00
{txt}(1 observation deleted)
{p 0 4}
variable{txt} group2004
does not uniquely identify observations in
the master data
{p_end}

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      5,005       99.94       99.94
{txt}          4 {c |}{res}          3        0.06      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,008      100.00
{txt}(0 observations deleted)
{p 0 4}
variable{txt} group2005
does not uniquely identify observations in
the master data
{p_end}

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      5,006       98.70       98.70
{txt}          2 {c |}{res}         64        1.26       99.96
{txt}          4 {c |}{res}          2        0.04      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,072      100.00
{txt}(64 observations deleted)
{p 0 4}
variable{txt} group2006
does not uniquely identify observations in
the master data
{p_end}

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      5,008      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,008      100.00
{txt}(0 observations deleted)
{p 0 4}
variable{txt} group2007
does not uniquely identify observations in
the master data
{p_end}

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,999       99.76       99.76
{txt}          2 {c |}{res}          3        0.06       99.82
{txt}          4 {c |}{res}          9        0.18      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,011      100.00
{txt}(3 observations deleted)
{p 0 4}
variable{txt} group2008
does not uniquely identify observations in
the master data
{p_end}

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      4,989       98.60       98.60
{txt}          2 {c |}{res}         52        1.03       99.62
{txt}          3 {c |}{res}          1        0.02       99.64
{txt}          4 {c |}{res}         18        0.36      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,060      100.00
{txt}(52 observations deleted)
{p 0 4}
variable{txt} group2009
does not uniquely identify observations in
the master data
{p_end}

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      5,007       99.96       99.96
{txt}          2 {c |}{res}          1        0.02       99.98
{txt}          3 {c |}{res}          1        0.02      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,009      100.00
{txt}(1 observation deleted)
{p 0 4}
variable{txt} group2010
does not uniquely identify observations in
the master data
{p_end}

     _merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}      5,008      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      5,008      100.00
{txt}(0 observations deleted)

{com}.                 
.                 tab exit

       {txt}exit {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}        155      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        155      100.00
{txt}
{com}.                 bysort setyr: egen temp = max(exit)
{txt}(4750 missing values generated)

{com}.                 tab temp

       {txt}temp {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}        258      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        258      100.00
{txt}
{com}.                         * all codes with the same setyr as the codes that exit also need to be dropped for consistency over time
.                         keep if temp==1
{txt}(4750 observations deleted)

{com}.                         drop exit
{txt}
{com}.                         rename temp exit
{txt}
{com}.                 save temp, replace
{txt}file temp.dta saved

{com}.                         * file with all exit codes that feature in concordance file, we need to append file with original codes
.                         * some codes that exit may not feature in the setyr file (if they have not changed over time)
.         
.         * we want files with exit codes that need to be dropped from data for consistency over time
.         
.                 forval y = `b'/`e' {c -(}    
{txt}  2{com}.                         use temp, clear
{txt}  3{com}.                                 keep group`y' exit
{txt}  4{com}.                                 capture append using temp_exit_`y'
{txt}  5{com}.                                 duplicates drop
{txt}  6{com}.                                 count
{txt}  7{com}.                                         * number of PC8 codes that needs to be dropped for consistency over time
.                                         * specific to chosen time period (if sample period changes, files should be run again)
.                                 rename group`y' pc8
{txt}  8{com}.                                 sort pc8
{txt}  9{com}.                                 save exit_`y', replace
{txt} 10{com}.                                 {c )-}

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(117 observations deleted)
{res}  141
{txt}(note: file exit_1993.dta not found)
file exit_1993.dta saved

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(120 observations deleted)
{res}  145
{txt}(note: file exit_1994.dta not found)
file exit_1994.dta saved

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(126 observations deleted)
{res}  180
{txt}(note: file exit_1995.dta not found)
file exit_1995.dta saved

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(100 observations deleted)
{res}  187
{txt}(note: file exit_1996.dta not found)
file exit_1996.dta saved

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(83 observations deleted)
{res}  175
{txt}(note: file exit_1997.dta not found)
file exit_1997.dta saved

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(85 observations deleted)
{res}  175
{txt}(note: file exit_1998.dta not found)
file exit_1998.dta saved

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(88 observations deleted)
{res}  233
{txt}(note: file exit_1999.dta not found)
file exit_1999.dta saved

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(25 observations deleted)
{res}  233
{txt}(note: file exit_2000.dta not found)
file exit_2000.dta saved

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(26 observations deleted)
{res}  232
{txt}(note: file exit_2001.dta not found)
file exit_2001.dta saved

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(26 observations deleted)
{res}  235
{txt}(note: file exit_2002.dta not found)
file exit_2002.dta saved

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(23 observations deleted)
{res}  248
{txt}(note: file exit_2003.dta not found)
file exit_2003.dta saved

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(13 observations deleted)
{res}  248
{txt}(note: file exit_2004.dta not found)
file exit_2004.dta saved

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(78 observations deleted)
{res}  246
{txt}(note: file exit_2005.dta not found)
file exit_2005.dta saved

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(76 observations deleted)
{res}  182
{txt}(note: file exit_2006.dta not found)
file exit_2006.dta saved

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(87 observations deleted)
{res}  183
{txt}(note: file exit_2007.dta not found)
file exit_2007.dta saved

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(122 observations deleted)
{res}  207
{txt}(note: file exit_2008.dta not found)
file exit_2008.dta saved

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(104 observations deleted)
{res}  156
{txt}(note: file exit_2009.dta not found)
file exit_2009.dta saved

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(104 observations deleted)
{res}  154
{txt}(note: file exit_2010.dta not found)
file exit_2010.dta saved

{com}.                 
.                 
. ****************************************************************************    
. *** Step 6: Generate overall concordance file for implementation in data ***
. ****************************************************************************                    
.                 
. * merge entry/exit codes with final concordance (to know which PC8 codes need to be dropped for consistent coverage over time)
. 
.         foreach y of numlist `b'/`e' {c -(}
{txt}  2{com}.                         use setyr_PC_`b'_`e', clear
{txt}  3{com}.                         keep group`y' setyr 
{txt}  4{com}.                         rename group`y' group
{txt}  5{com}.                         sort group
{txt}  6{com}.                         drop if group==.
{txt}  7{com}.                         
.                         save setyr_PC_`y', replace
{txt}  8{com}.                         
.                 use PC_`y', clear
{txt}  9{com}.                         destring pc, replace
{txt} 10{com}.                         rename pc group
{txt} 11{com}.                         sort group
{txt} 12{com}.                         merge group using setyr_PC_`y'
{txt} 13{com}.                         tab _m
{txt} 14{com}.                                 * _m==2 should not occur
.                         rename group pc8
{txt} 15{com}.                         rename setyr pc8plus
{txt} 16{com}.                         keep pc8 pc8plus
{txt} 17{com}.                         duplicates drop
{txt} 18{com}.                         sort pc8
{txt} 19{com}.                         count if pc8==pc8[_n-1]
{txt} 20{com}.                                 * should not occur
.                         
.                         merge pc8 using exit_`y'
{txt} 21{com}.                         drop if _m==2
{txt} 22{com}.                         tab exit
{txt} 23{com}.                         drop _m
{txt} 24{com}.                         gen year=`y'
{txt} 25{com}.                         sort pc8
{txt} 26{com}.                         save temp_`y', replace
{txt} 27{com}.                         {c )-}
{txt}(232 observations deleted)
(note: file setyr_PC_1993.dta not found)
file setyr_PC_1993.dta saved
pc has all characters numeric; {res}replaced {txt}as {res}long

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}         28        0.58        0.58
{txt}          2 {c |}{res}          2        0.04        0.62
{txt}          3 {c |}{res}      4,774       99.38      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,804      100.00

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res}    0
{txt}(1 observation deleted)

       exit {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}        140      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        140      100.00
{txt}(note: file temp_1993.dta not found)
file temp_1993.dta saved
(216 observations deleted)
(note: file setyr_PC_1994.dta not found)
file setyr_PC_1994.dta saved
pc has all characters numeric; {res}replaced {txt}as {res}long

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}         51        1.05        1.05
{txt}          2 {c |}{res}         13        0.27        1.32
{txt}          3 {c |}{res}      4,779       98.68      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,843      100.00

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res}    0
{txt}(3 observations deleted)

       exit {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}        142      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        142      100.00
{txt}file temp_1994.dta saved
(185 observations deleted)
(note: file setyr_PC_1995.dta not found)
file setyr_PC_1995.dta saved
pc has all characters numeric; {res}replaced {txt}as {res}long

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}         31        0.64        0.64
{txt}          2 {c |}{res}         14        0.29        0.93
{txt}          3 {c |}{res}      4,809       99.07      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,854      100.00

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res}    0
{txt}(8 observations deleted)

       exit {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}        172      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        172      100.00
{txt}file temp_1995.dta saved
(222 observations deleted)
(note: file setyr_PC_1996.dta not found)
file setyr_PC_1996.dta saved
pc has all characters numeric; {res}replaced {txt}as {res}long

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}         37        0.77        0.77
{txt}          2 {c |}{res}         16        0.33        1.10
{txt}          3 {c |}{res}      4,770       98.90      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,823      100.00

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res}    0
{txt}(13 observations deleted)

       exit {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}        174      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        174      100.00
{txt}file temp_1996.dta saved
(222 observations deleted)
(note: file setyr_PC_1997.dta not found)
file setyr_PC_1997.dta saved
pc has all characters numeric; {res}replaced {txt}as {res}long

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}         37        0.77        0.77
{txt}          2 {c |}{res}         16        0.33        1.10
{txt}          3 {c |}{res}      4,770       98.90      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,823      100.00

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res}    0
{txt}(1 observation deleted)

       exit {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}        174      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        174      100.00
{txt}(note: file temp_1997.dta not found)
file temp_1997.dta saved
(222 observations deleted)
(note: file setyr_PC_1998.dta not found)
file setyr_PC_1998.dta saved
pc has all characters numeric; {res}replaced {txt}as {res}long

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}         41        0.85        0.85
{txt}          2 {c |}{res}         18        0.37        1.22
{txt}          3 {c |}{res}      4,768       98.78      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,827      100.00

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res}    0
{txt}(1 observation deleted)

       exit {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}        174      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        174      100.00
{txt}file temp_1998.dta saved
(196 observations deleted)
(note: file setyr_PC_1999.dta not found)
file setyr_PC_1999.dta saved
pc has all characters numeric; {res}replaced {txt}as {res}long

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}         48        0.99        0.99
{txt}          2 {c |}{res}         21        0.43        1.42
{txt}          3 {c |}{res}      4,791       98.58      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,860      100.00

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res}    0
{txt}(1 observation deleted)

       exit {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}        232      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        232      100.00
{txt}file temp_1999.dta saved
(200 observations deleted)
(note: file setyr_PC_2000.dta not found)
file setyr_PC_2000.dta saved
pc has all characters numeric; {res}replaced {txt}as {res}long

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}         44        0.91        0.91
{txt}          2 {c |}{res}         20        0.41        1.32
{txt}          3 {c |}{res}      4,788       98.68      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,852      100.00

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res}    0
{txt}(1 observation deleted)

       exit {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}        232      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        232      100.00
{txt}file temp_2000.dta saved
(238 observations deleted)
(note: file setyr_PC_2001.dta not found)
file setyr_PC_2001.dta saved
pc has all characters numeric; {res}replaced {txt}as {res}long

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}         43        0.89        0.89
{txt}          2 {c |}{res}         20        0.42        1.31
{txt}          3 {c |}{res}      4,750       98.69      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,813      100.00

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res}    0
{txt}(1 observation deleted)

       exit {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}        231      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        231      100.00
{txt}file temp_2001.dta saved
(267 observations deleted)
(note: file setyr_PC_2002.dta not found)
file setyr_PC_2002.dta saved
pc has all characters numeric; {res}replaced {txt}as {res}long

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}         43        0.90        0.90
{txt}          2 {c |}{res}         20        0.42        1.32
{txt}          3 {c |}{res}      4,721       98.68      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,784      100.00

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res}    0
{txt}(1 observation deleted)

       exit {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}        234      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        234      100.00
{txt}file temp_2002.dta saved
(334 observations deleted)
(note: file setyr_PC_2003.dta not found)
file setyr_PC_2003.dta saved
pc has all characters numeric; {res}replaced {txt}as {res}long

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}         36        0.76        0.76
{txt}          2 {c |}{res}         17        0.36        1.13
{txt}          3 {c |}{res}      4,657       98.87      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,710      100.00

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res}    0
{txt}(2 observations deleted)

       exit {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}        246      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        246      100.00
{txt}file temp_2003.dta saved
(344 observations deleted)
(note: file setyr_PC_2004.dta not found)
file setyr_PC_2004.dta saved
pc has all characters numeric; {res}replaced {txt}as {res}long

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}         36        0.77        0.77
{txt}          2 {c |}{res}         17        0.36        1.13
{txt}          3 {c |}{res}      4,647       98.87      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,700      100.00

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res}    0
{txt}(1 observation deleted)

       exit {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}        247      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        247      100.00
{txt}file temp_2004.dta saved
(541 observations deleted)
(note: file setyr_PC_2005.dta not found)
file setyr_PC_2005.dta saved
pc has all characters numeric; {res}replaced {txt}as {res}long

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}         40        0.89        0.89
{txt}          2 {c |}{res}         18        0.40        1.29
{txt}          3 {c |}{res}      4,449       98.71      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,507      100.00

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res}    0
{txt}(65 observations deleted)

       exit {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}        181      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        181      100.00
{txt}file temp_2005.dta saved
(543 observations deleted)
(note: file setyr_PC_2006.dta not found)
file setyr_PC_2006.dta saved
pc has all characters numeric; {res}replaced {txt}as {res}long

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}         40        0.89        0.89
{txt}          2 {c |}{res}         18        0.40        1.29
{txt}          3 {c |}{res}      4,447       98.71      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,505      100.00

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res}    0
{txt}(1 observation deleted)

       exit {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}        181      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        181      100.00
{txt}file temp_2006.dta saved
(612 observations deleted)
(note: file setyr_PC_2007.dta not found)
file setyr_PC_2007.dta saved
pc has all characters numeric; {res}replaced {txt}as {res}long

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}         40        0.90        0.90
{txt}          2 {c |}{res}         18        0.41        1.31
{txt}          3 {c |}{res}      4,378       98.69      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      4,436      100.00

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res}    0
{txt}(4 observations deleted)

       exit {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}        179      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        179      100.00
{txt}file temp_2007.dta saved
(1144 observations deleted)
(note: file setyr_PC_2008.dta not found)
file setyr_PC_2008.dta saved
pc has all characters numeric; {res}replaced {txt}as {res}long

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          3 {c |}{res}      3,864      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      3,864      100.00

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res}    0
{txt}(53 observations deleted)

       exit {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}        154      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        154      100.00
{txt}file temp_2008.dta saved
(1157 observations deleted)
(note: file setyr_PC_2009.dta not found)
file setyr_PC_2009.dta saved
pc has all characters numeric; {res}replaced {txt}as {res}long

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          3 {c |}{res}      3,851      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      3,851      100.00

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res}    0
{txt}(2 observations deleted)

       exit {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}        154      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        154      100.00
{txt}file temp_2009.dta saved
(1176 observations deleted)
(note: file setyr_PC_2010.dta not found)
file setyr_PC_2010.dta saved
pc has all characters numeric; {res}replaced {txt}as {res}long

     {txt}_merge {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          3 {c |}{res}      3,832      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      3,832      100.00

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(0 observations are duplicates)
{res}    0
{txt}(1 observation deleted)

       exit {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}        153      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        153      100.00
{txt}file temp_2010.dta saved

{com}.         
.         use temp_`b', clear
{txt}
{com}.                 forval y = `b1' / `e' {c -(}
{txt}  2{com}.                         append using temp_`y'
{txt}  3{com}.                         {c )-}
{txt}
{com}.                 sort pc8 year
{txt}
{com}.                 gen synthetic = (pc8plus!=.)
{txt}
{com}.                 replace pc8plus = pc8 if pc8plus==.
{txt}(595 real changes made)

{com}.                 count if pc8==pc8[_n-1] & year==year[_n-1]
{res}    0
{txt}
{com}.         save "output\pc8_pc8plus_`b'_`e'", replace
{txt}(note: file output\pc8_pc8plus_1993_2010.dta not found)
file output\pc8_pc8plus_1993_2010.dta saved

{com}.         outsheet using "output\pc8_pc8plus_`b'_`e'.csv", replace
{txt}(note: file output\pc8_pc8plus_1993_2010.csv not found)

{com}. 
. ***************************************************
. *** Step 4: Concording domestic production data ***
. ***************************************************     
. /* Procedure:
>                 A/ Read in domestic production data for the period `b' - `e'
>                 B/ Rename the variable recording the original (unconcorded) PC8 products as "pc8"
>                 C/ Make sure the pc8 variable is string in the production data and sort on "pc8"
>                 D/ Recode optional (B-list) codes into mandatory codes (provided they feature in data)
>                         Perform a many-one merge on "pc8" with the file "optional_codes_`b'_`e'_sample"
>                         If _m==3, replace pc8 with the mandatory code (pc_mand). Drop pc_mand and merge variables.
>                         
>                 E/ Recode optional (N-list) codes into mandatory codes (provided they feature in the data)
>                         Perform a many-one merge on "pc8" with the file "Nlist_codes_1993_2005" 
>                         If _m==3, replace pc8 with the mandatory code (pc_mand). Drop pc_mand and merge variables.
>                 
>                 D/ Destring the PC8 variable (replace). If the destring procedure fails, there are still non-numeric characters in the PC8 codes.
>                         This should not occur (only N, T, Z, Q and E codes are non-numeric, they should not feature in the data at this point. 
>                         Verify which codes are causing the problem and address accordingly.
>                         
>                 E/ Perform a many-one merge on "pc8" and "year" (numeric format) with the file "cn8_cn8plus_`b'_`e'"
>                 E/ In principle, all PC8 codes that appear in the data should feature in the concordance
>                         * If some PC8 codes do not feature in concordance, this could be due to reporting errors or "residual" categories
>                         * Unmatched PC8 codes need to be dropped (no corresponding PC8+ code)
>                 F/ Aggregate the data from PC8 product level to PC8+ level (if data are at firm-product level, aggregate from firm-PC8 to firm-PC8+)
> */              
. 
. /* Example: Belgian product-level (PC8) panel production data 
> 
>         * Recode optional codes and N-list codes where necessary
>                 * Using list of optional codes generated above
>                 * Blist and Nlist: first prepare files
>                 
>                 if `b' < 2005 {c -(}
>                         use Nlist_codes_1993_2005, clear
>                                 sort pc8
>                                 count if pc8==pc8[_n-1]
>                         save temp_nlist, replace
>                         
>                         use optional_codes_`b'_`e'_sample, clear
>                                 duplicates drop
>                                 sort pc8
>                                 count if pc8==pc8[_n-1]
>                         save temp_blist, replace
>                         {c )-}
>                         
>         * merge with data
>                 * Select production data
>                                         
>                         use production_pt_`b'_`e', clear
>                                 
>                                 label var lev3v_prod "Production value sold"
>                                 label var prodcom "PC8 product, string"
>                                 label var mioQ "Production value sold, mio"
>                         
>                                 sort year prodcom
>                                 count if year==year[_n-1] & prodcom==prodcom[_n-1]
>                                 rename prodcom pc8
>                                 
>                         if `b' < 2005 {c -(} 
>                                 * merge with list of N-codes to recode if applicable
>                                         merge pc8 using temp_nlist
>                                         capture table pc8 if _m==3, c(count lev3v_prod sum lev3v_prod sum mioQ) format(%20.2fc) row
>                                         replace pc8 = pc_mand if _m==3
>                                         drop if _m==2
>                                         drop _m pc_mand
>                                 
>                                 * merge with list of B-codes to recode if applicable
>                                         merge pc8 using temp_blist
>                                         drop if _m==2
>                                         capture table pc8 if _m==3, c(count lev3v_prod sum lev3v_prod sum mioQ) format(%20.2fc) row
>                                         replace pc8 = pc_mand if _m==3
>                                         drop pc_mand
>                                         drop _m
>                         
>                                 {c )-}
>                                 
>                                 destring pc8, replace
>                                 sort year pc8
>                                 
>                                 count if year==year[_n-1] & pc8==pc8[_n-1]
>                                         * due to recoding, there might be doubles, need to be collapsed
>                                         * e.g. two optional codes that map into one mandatory code
>                 
>                         if `b' < 2005 {c -(} 
>                                 collapse (sum) lev3v_prod mioQ, by(year pc8)
>                                         * only mandatory PC8 codes left in the data
>                                         * these should all feature in the concordance (exception: coding errors, residual (country-specific) categories)
>                                 {c )-}
>                                 
>                                 * concording PC8 products in each year (merge data with only mandatory products with concordance files
>                                 
>                                         sort pc8 year
>                                         merge pc8 year using "output\pc8_pc8plus_`b'_`e'"
>                                         tab _m
>                                         replace exit=0 if exit==.
>                                         table pc8 if _m==1, c(count year sum mioQ sum lev3v_prod) format(%20.2fc) row
>                                         table exit, c(count pc8 sum mioQ sum lev3v_prod) format(%20.2fc) row
>                                         table _m, c(count year sum mioQ sum lev3v_prod) format(%20.2fc) row
>                                         
>                                         * drop PC8 products not recognized in concordance (coding errors, residual categories)
>                                                 keep if _m==3
>                                         
>                                         * drop PC8 products that need to be dropped for consistency over time
>                                                 drop if exit==1
>                                                 
>                                         * collapse to PC8+ level if applicable
>                                                 tab year
>                                                 sort year pc8plus
>                                                 count if year==year[_n-1] & pc8plus==pc8plus[_n-1]
>                                                 collapse (sum) lev3v_prod mioQ, by(year pc8plus)
>                                                 tab year 
>                                         save production_pt_concorded_`b'_`e', replace
>                                 
>                         */
.                         
. 
. 
. log close
       {txt}log:  {res}C:\Users\n06017\Documents\Magic Briefcase\pc8_over_time\output\pc8_over_time_1993_2010.smcl
  {txt}log type:  {res}smcl
 {txt}closed on:  {res} 1 Aug 2012, 07:02:43
{txt}{.-}
{smcl}
{txt}{sf}{ul off}